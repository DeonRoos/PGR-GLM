<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Exercise</title>

<script src="site_libs/header-attrs-2.25/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">PGR-GLM</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="setup.html">
    <span class="fa fa-cog"></span>
     
    Setup
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    R Book
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://intro2r.com">
        <span class="fa fa-firefox"></span>
         
        Web book
      </a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="https://github.com/alexd106/Rbook/raw/master/docs/Rbook.pdf">
        <span class="fa fa-file-pdf"></span>
         
        PDF book
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    Exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="exercises.html">
        <span class="fa fa-book"></span>
         
        Exercises
      </a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="exercise_solutions.html">
        <span class="fa fa-book"></span>
         
        Exercise Solutions
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="data.html">
    <span class="fa fa-download"></span>
     
    Data
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-question-circle"></span>
     
    Info
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="syllabus.html">
        <span class="fa fa-graduation-cap"></span>
         
        Syllabus
      </a>
    </li>
    <li>
      <a href="People.html">
        <span class="fa fa-user-friends"></span>
         
        People
      </a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="resources.html">
        <span class="fa fa-book"></span>
         
        Resources
      </a>
    </li>
    <li class="dropdown-header">Feedback</li>
    <li>
      <a href="People.html">
        <span class="fa fa-envelope fa-lg"></span>
         
        Contact
      </a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="https://github.com/alexd106/PGR-GLM">
        <span class="fa fa-github fa-lg"></span>
         
        Source code
      </a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Exercise</h1>

</div>


<p> </p>
<div id="exercise-poisson-glm---predicting-species-richness"
class="section level1">
<h1>Exercise: Poisson GLM - predicting species richness</h1>
<p> </p>
<p>For the GLM exercises, we’ll use the workflow we suggested in the
first GLM overview lecture as a template, specifically:</p>
<ol style="list-style-type: decimal">
<li><p>Know your research question!</p></li>
<li><p>Think about your response variable (stochastic).</p></li>
<li><p>Think about the process behind the data (deterministic).</p></li>
<li><p>Understand the data that you’ve collected (plot it!)</p></li>
<li><p>Combine into a model that can answer your question.</p></li>
<li><p>Fit the model.</p></li>
<li><p>Check your assumption(s).</p></li>
<li><p>Answer your question.</p></li>
</ol>
<p><br />
</p>
<p>1. Know your research question!</p>
<p>The researchers who collected this data wanted to describe the
relationships between the number of species (<code>Species</code>)
present in a plot of land, and how this number was associated with the
overall plant biomass (<code>Biomass</code>, i.e. what was the overall
weight of plants in the plot of land), and the pH of the soil
(<code>pH</code>, categorised into “High”, “Medium” and “Low”). The
researchers were interested in describing the associations between
species and the two explanatory variables. In total, the researchers
collected data from 90 plots of land (<span class="math inline">\(n =
90\)</span>), where each observation is from a single plot.</p>
<p>As concisely as possible, write down the research question that can
be answered with our analysis. This might seem trivial in this case, but
it’s often one of the hardest parts of research; going from science to
an actionable research question.</p>
<p>2. Think about your response variable (the stochastic element).</p>
<p>From the information provided in the brief above, we are already able
to determine a suitable distribution to use when fitting the model (the
fact that this practical is called Poisson GLM may also offer a rather
cryptic hint…). The relevant information comes from the description of
<code>Species</code> clearly indicating that this variable is a count,
which implies 1) the minimum value is 0 [we cannot have -1 species], and
2) the response variable will be measured in integers [we cannot count
3.14 plants]. With this information alone, we can already deduce the
<em>stochastic</em> element of our model (i.e. the error) should be
adequately described by specifying a <span
class="math inline">\(Poisson\)</span> distribution.</p>
<p>If you’re comfortable doing so, write down the stochastic element of
our model using statistical notation.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># y ~ Poisson(lambda)</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co"># Where</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="co"># y is the count of species in a given plot</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="co"># lambda is the rate parameter for the Poisson distribution</span></span></code></pre></div>
<p><br />
</p>
<p>3. Think about the process behind the data (the deterministic
element).</p>
<p>Spare a moment’s thought to how complex the process behind the number
of plant species present in a plot of land will be. How much sunlight
does each plot get? How much rainfall? What seeds were already present
in the soil before data collection started? Why were <em>those</em>
seeds present and not others? Why did some of them germinate in time for
us to count them? We don’t have any data to try and explain this
variation, yet it will still be there (this is what we are tasking the
stochastic part of the model to deal with).</p>
<p>For our purposes, we’re interested in how plant biomass and soil pH
affect species richness. If you’re comfortable doing so, write down a
sensible deterministic element for the model you would run, using
statistical notation.</p>
<p> </p>
<p>4. Understand the data that you’ve collected (plot it!)</p>
<p>We now get to the part where we’ll actually start using
<code>R</code>. A plea though - do not underestimate the value in taking
the time to think carefully about the previous steps. Spending the time
thinking about those questions makes your life that much easier. I’d
estimate that for my own work, I spend at least 60% of my time thinking
before doing anything with data or <code>R</code>. It really is that
important.</p>
<p>4.1. Get R ready to go</p>
<p>As in previous exercises, either create a new R script (perhaps call
it GLM_Poisson) or continue with your previous R script in your RStudio
Project. Again, make sure you include any metadata you feel is
appropriate (title, description of task, date of creation etc) and don’t
forget to comment out your metadata with a <code>#</code> at the
beginning of the line.</p>
<p>4.2. Data exploration</p>
<p>Import the data file ‘species.txt’ into R and take a look at the
structure of this dataframe. Given you have never seen this data before,
it’s really important that you familiarise yourself with any nuances. To
help with this, carry out an initial data exploration (using any methods
you think will help you get a sense of the data,
e.g. <code>plot()</code>, <code>pairs()</code>, <code>coplot()</code>,
amongst many other options).</p>
<p>While doing this, ask yourself:</p>
<ul>
<li>Do any of the variables need to be adjusted? (e.g. are factors
recognised as such?)</li>
<li>Do any factors need to be “re-levelled”, such that it is read “Low”,
“Medium”High” (or any order we may prefer)?
<ul>
<li>(Hint: check <code>?factor</code> and look at the
<code>levels</code> argument)</li>
</ul></li>
<li>Are there any relationships you can already see by eye alone?</li>
<li>Are there any imbalances in any of the explanatory variables?</li>
<li>Are there any observations that seem like they may be a data entry
mistake?</li>
</ul>
<p>If using <code>pairs()</code> to create a plot of the variables of
interest, rather than creating a plot with every single variable in our
dataset, we may prefer to restrict the plot to the variables we are
actually interested in (this is redundant for this dataset but it’s
worth keeping this trick in mind for larger datasets). An effective way
of doing this is to store the names of the variables of interest in a
vector <code>VOI&lt;- c("Var1", "Var2", ...)</code> and then use the
list of variable names to subset the variables that get plotted
(e.g. <code>pairs(Mydata[, VOI])</code>)</p>
<p> </p>
<p><img src="GLM_1_Poisson_exercise_files/figure-html/Q4-1.png" width="672" /><img src="GLM_1_Poisson_exercise_files/figure-html/Q4-2.png" width="672" /></p>
<p>5. Combine into a model that can answer your question.</p>
<p>Having thought through the above details, it’s now time to bring that
information together into a single model. As a reminder, we want to
describe the associations between species richness and plant biomass,
and soil pH. Given this is the first practical session, we’ll break this
up for the sake of pedagogy. Let’s start with species richness explained
by biomass. Write the equation (not the <code>R</code> code) for this
model (i.e. combine the stochastic and deterministic elements from
Questions 3 and 4).</p>
<p>For example, an intercept-only <span
class="math inline">\(Poisson\)</span> GLM would be:</p>
<p><span class="math display">\[
y_i \sim Poisson(\lambda_i)\\
log(\lambda_i) = \beta_0
\]</span></p>
<p>where, <span class="math inline">\(y_i\)</span> is the value of the
response variable for the <span class="math inline">\(i^{th}\)</span>
plot of land (e.g. if <span class="math inline">\(i = 1\)</span>, then
this indicates the first row of our dataset, or the first plot of land
we have data for), assumed to follow a <span
class="math inline">\(Poisson\)</span> distribution with rate <span
class="math inline">\(/lambda\)</span>, regressed on the <span
class="math inline">\(log\)</span> link as a function of an intercept
(<span class="math inline">\(\beta_0\)</span>) only.</p>
<p>6. Fit the model.</p>
<p>To warm up, let’s start by a simpler model, where we assume that the
number <code>Species</code> counted in a plot is a function of how much
<code>Biomass</code> there was. We’ll leave <code>pH</code> out of the
model for the time being.</p>
<p>Run the model now, using <code>glm()</code>.</p>
<ul>
<li>Hints:
<ul>
<li>We use <code>family =</code> to specify the distribution in a
<code>glm()</code>
<ul>
<li>“Family” is just an alternative way to refer to a distribution.</li>
</ul></li>
<li>What is the default link function used by Poisson GLMs?
<ul>
<li>How do we specify it?</li>
<li>Do we need to specify it?</li>
</ul></li>
<li>Use <code>?glm</code> if you’re stuck, or ask for help.</li>
</ul></li>
</ul>
<p> </p>
<p>7. Check your assumption(s).</p>
<p>Even though this isn’t our final model, it can still be worthwhile to
check how well this model met the assumptions.</p>
<p>To do so, we can check the model diagnostic plots, as well as check
for dispersion. Do so now.</p>
<p>For the diagnostic plots:</p>
<ul>
<li>Residuals vs Fitted
<ul>
<li>What kind of pattern would we expect?</li>
</ul></li>
<li>Q-Q Residuals
<ul>
<li>Are we expecting Normally distribted error with a Poisson
distribution?</li>
</ul></li>
<li>Scale-Location
<ul>
<li>What is the maximum <span class="math inline">\(\sqrt{|Std.
PearsonResid|}\)</span> we would be comfortable with?</li>
</ul></li>
<li>Residuals vs Leverage
<ul>
<li>Are any observations having a strong influence on the model
fit?</li>
</ul></li>
</ul>
<p><img src="GLM_1_Poisson_exercise_files/figure-html/Q7-1.png" width="672" /></p>
<p>8. Answer your question</p>
<p>Hopefully you identified issues that mean we should be very cautious
with interpreting this simple version of the model. For now, we’ll put
these concerns to rest, and use this model as an opportunity to practice
making predictions (and therefore answering our research question).</p>
<p>8.1. Go back to your equation that you wrote for question 5. Using
<code>summary()</code>, replace the place-holder letters (e.g. <span
class="math inline">\(\beta_0\)</span>) with the estimated values from
your model. Using this updated equation, make the following
predictions:</p>
<ul>
<li><p>On the link scale, how many plants would you predict if a plot
had 0 kg of biomass?</p></li>
<li><p>On the link scale, how many plants would you predict if a plot
had 2.5 kg of biomass?</p></li>
<li><p>On the link scale, how many plants would you predict if a plot
had 5 kg of biomass?</p></li>
</ul>
<p>8.2. Now, let’s make predictions on the response scale. To go from
the <span class="math inline">\(log\)</span> link scale, to the response
scale, we take our predictions and apply the inverse link function to
them. The inverse link function of <span
class="math inline">\(log\)</span> is <span
class="math inline">\(e\)</span> (or exponential, or
<code>exp()</code>). Predict, on the response scale, how many plant
species we would observe if:</p>
<ul>
<li><p>On the response scale, how many plants would you predict if a
plot had 0 kg of biomass?</p></li>
<li><p>On the response scale, how many plants would you predict if a
plot had 5 kg of biomass?</p></li>
<li><p>On the response scale, how many plants would you predict if a
plot had 10 kg of biomass?</p></li>
</ul>
<p>8.3. Using this approach, we get a series of snapshot predictions.
That’s useful in and of itself, but we can make this a bit easier
visually. To do so, rather copy-and-pasting our equation and
substituting in different value of biomass, why not use <code>R</code>
to make this a bit easier for us. Begin by using <code>seq()</code> to
create a sequence of 5 biomass values that range from the minimum we
observed in the data, to the maximum, and store this variable.</p>
<p>Hint: do not add this new biomass variable to your original
dataset.</p>
<p>8.4. Once you have this variable (or “vector”), use it to make 5
simultaneous predictions of how many plant species we would expect to
find, on the response scale. Store the output in another variable.</p>
<p>8.5. With both of these new variables, create a plot to show our
prediction.</p>
<p><img src="GLM_1_Poisson_exercise_files/figure-html/Q8.5-1.png" width="672" /></p>
<p>And with that, we have a prediction (from our model which we know has
issues). If we stopped here, we’d conclude that biomass has a negative
association with the number of plant species.</p>
<p>8.6. (Optional): The figure we have produced is pretty jagged
looking. If we wanted a smoother line to be drawn, how would we do
so?</p>
<p> </p>
<p>9. We’ve run a Poisson GLM where <code>Species</code> is explained by
<code>Biomass</code>, but remember that our initial research question
sought to describe the relationships between <code>Species</code> with
both <code>Biomass</code> and <code>pH</code>. Before running this
model, try to write down the equation for this new version of the model.
Keep in mind that <code>pH</code> is a categorical variable, meaning
we’ll need additional covariates to indicate if an observation is,
e.g. “Medium” pH (1) or not (0), or “High” pH (1) or not (0). (If you’re
not sure how to do this, you can either go back and watch the relevant
sections of the Poisson lecture or ask for help).</p>
<p>9.1. Once you’ve given that a shot, run the <code>glm()</code> which
includes both <code>Biomass</code> and <code>pH</code> as main effects
only (we won’t be doing any interactions yet).</p>
<p> </p>
<p> </p>
<p>10. With every model we run, we need to re-diagnose the models. We’ve
already done that once, so let’s quickly do it again.</p>
<p>For the diagnostic plots:</p>
<ul>
<li>Residuals vs Fitted
<ul>
<li>What kind of pattern would we expect?</li>
</ul></li>
<li>Q-Q Residuals
<ul>
<li>Are we expecting Normally distribted error with a Poisson
distribution?</li>
</ul></li>
<li>Scale-Location
<ul>
<li>What is the maximum <span class="math inline">\(\sqrt{|Std.
PearsonResid|}\)</span> we would be comfortable with?</li>
</ul></li>
<li>Residuals vs Leverage
<ul>
<li>Are any observations having a strong influence on the model
fit?</li>
</ul></li>
</ul>
<p><img src="GLM_1_Poisson_exercise_files/figure-html/Q10-1.png" width="672" /></p>
<p>11. (Optional): Obtain and compare summaries of the model output
using the <code>summary()</code> and the ANOVA of the model.</p>
<ul>
<li>Which of the <code>drop1()</code> or <code>anova()</code> functions
would you choose to use if you wanted to
<ul>
<li>look at deviance components?</li>
<li>explain the predictions?</li>
<li>test hypotheses?</li>
<li>carry out variable selection?</li>
</ul></li>
</ul>
<p> </p>
<p> </p>
<p>12. Now that we’ve fit the full model, let’s begin the process of
interpreting what the results mean. For starters, given this is a more
complex model, let’s take it slowly and make sure we understand what
each parameter estimate means. Using <code>summary()</code>, identify
what each parameter means.</p>
<p> </p>
<p> </p>
<p>13. Create full predictions and a figure to visualise your
relationship</p>
<p>We can use the same technique we used for the model with just
biomass, but now extend it to include the differing levels of pH. In
addition, rather than manually writing out the equation (and possibly
making mistakes), we can use the <code>predict()</code> function to just
do it for us. A trick we can use here is to make use of the
<code>expand.grid()</code> function, to create a new dataset that has a
sequence of biomass values, that is replicate for each level of pH. To
do so, we need to specify the range of values for both
<code>biomass</code> and <code>ph</code>. We already did this for
<code>biomass</code>, and it’s pretty easy to do for <code>ph</code> as
well: <code>c("Low", "Medium", "High")</code>. With that, we can use the
following code:</p>
<p><code>synth_data &lt;- expand.grid(Biomass = seq(from = min(dat$Biomass), to = max(dat$Biomass), length.out = 5), pH = c("low", "mid", "high"))</code></p>
<p>to create a new <em>synthetic</em> dataset, which we can use in the
<code>predict()</code> function:</p>
<p><code>synth_data$pred &lt;- predict(sp.glm2, newdata = synth_data)</code></p>
<p>A hint: we can tell the <code>predict()</code> function to use the
inverse link function automatically when making the predictions, so we
don’t need to by setting <code>type = "response"</code> or else we could
always do this manually by exponentiating our predicted values.</p>
<p>Using your synthetic dataset and model, create predictions of species
richness. Once done, then use these to create a figure to show your
predicted relationships for pH and biomass.</p>
<p>14. (Optional) Exploring model diagnostics</p>
<p>One of the most challenging aspects in learning GLMs is how to
determine if there is a problem in model diagnostics. Overwhelmingly,
this is because a lot of this relies on gaining enough experience to
know when there is a problem or not. To that end, as an optional
exercise, we include code to simulate data, run a <span
class="math inline">\(Poisson\)</span> GLM, and perform model
diagnostics on with the aim of giving you a flexible means to gain some
experience. The benefit of having you simulate datasets is that you know
what the <em>Truth</em> is, because you decide what it is. With that
anchor in place, you can then gauge when tools are reliable and when
they are not. In general, simulating datasets and testing your
statistical models is an excellent approach and one that is well worth
building into your data analysis workflow (ideally before ever
collecting real data).</p>
<p>The code to do the simulation can be found below, but is generated
(often called the <em>Data Generating Process</em>, or DGP, in both code
or real data sets) as:</p>
<p><span class="math inline">\(y_i \sim Poisson(\lambda_i)\)</span></p>
<p><span class="math inline">\(log(\lambda_i) = \beta_0 + \beta_1 \times
x_{1,i} + \beta_2 \times x_{2,i} + \beta_3\times x_{3,i}\)</span></p>
<p>Rerun the simulation and analysis varying the sample size
(<code>N &lt;- 1000</code>) or the formula of the <code>glm()</code>
(e.g. <code>y ~ x1 + x2</code>). Check what effect this has on
dispersion and the model diagnostic plots.</p>
<pre><code># Set your seed to have the randomness be cosnsitent each time you run the code
# You can change this, or comment it out, if you want to embrase the randomness
set.seed(1234)

# Set your sample size
N &lt;- 500

# Create two continuous covariates
x1 &lt;- runif(N, 0, 10)
x2 &lt;- runif(N, 0, 10)
x3 &lt;- runif(N, 0, 10)

# Set your parameter values
beta_0 &lt;- 2.5   # This is the intercept (on link scale)
beta_1 &lt;- 0.2   # This is the slope for the x1 variable (on link scale)
beta_2 &lt;- -1.3  # This is the slope for the x2 variable (on link scale)
beta_3 &lt;- 0.4   # This is the slope for the x3 variable (on link scale)

# Generate your linear predictor on the link scale (i.e. log)
# We don&#39;t actually need to use log() here (it&#39;s already on the link scale)
linear_predictor_link &lt;- beta_0 + beta_1 * x1 + beta_2 * x2 + beta_3 * x3
# Backtransform your linear predictor to the response scale (i.e. exponentiate)
linear_predictor_response &lt;- exp(linear_predictor_link)
# Generate your response variable
y &lt;- rpois(N, lambda = linear_predictor_response)
# Note that the above three lines of code are the equivalent to:
# y ~ Poisson(lambda)
# log(lambda) = beta_0 + beta_1 * x1 + beta_2 * x2

# Store your data in a dataframe
dat &lt;- data.frame(y, x1, x2, x3)

# Run a Poisson GLM
fit &lt;- glm(y ~ x1 + x2 + x3, 
           data = dat, 
           family = poisson)

# See if the model was able to estimate your parameter values
summary(fit)

# See how well the model diagnostics perform
par(mfrow = c(2,2))
plot(fit)</code></pre>
<p><strong>End of the Poisson GLM - predicting species richness
exercise</strong></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
