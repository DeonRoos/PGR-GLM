<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Exercise</title>

<script src="site_libs/header-attrs-2.25/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">PGR-GLM</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="setup.html">
    <span class="fa fa-cog"></span>
     
    Setup
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    R Book
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://intro2r.com">
        <span class="fa fa-firefox"></span>
         
        Web book
      </a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="https://github.com/alexd106/Rbook/raw/master/docs/Rbook.pdf">
        <span class="fa fa-file-pdf"></span>
         
        PDF book
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    Exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="exercises.html">
        <span class="fa fa-book"></span>
         
        Exercises
      </a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="exercise_solutions.html">
        <span class="fa fa-book"></span>
         
        Exercise Solutions
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="data.html">
    <span class="fa fa-download"></span>
     
    Data
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-question-circle"></span>
     
    Info
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="syllabus.html">
        <span class="fa fa-graduation-cap"></span>
         
        Syllabus
      </a>
    </li>
    <li>
      <a href="People.html">
        <span class="fa fa-user-friends"></span>
         
        People
      </a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="resources.html">
        <span class="fa fa-book"></span>
         
        Resources
      </a>
    </li>
    <li class="dropdown-header">Feedback</li>
    <li>
      <a href="People.html">
        <span class="fa fa-envelope fa-lg"></span>
         
        Contact
      </a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="https://github.com/alexd106/PGR-GLM">
        <span class="fa fa-github fa-lg"></span>
         
        Source code
      </a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Exercise</h1>

</div>


<p> </p>
<div id="exercise-binomial-glm---understanding-mrse"
class="section level1">
<h1>Exercise: Binomial GLM - understanding MRSE</h1>
<p> </p>
<p>For the GLM exercises, we’ll use the workflow we suggested in the
first GLM overview lecture as a template, specifically:</p>
<ol style="list-style-type: decimal">
<li><p>Know your research question!</p></li>
<li><p>Think about your response variable (stochastic).</p></li>
<li><p>Think about the process behind the data (deterministic).</p></li>
<li><p>Understand the data that you’ve collected (plot it!)</p></li>
<li><p>Combine into a model that can answer your question.</p></li>
<li><p>Fit the model.</p></li>
<li><p>Check your assumption(s).</p></li>
<li><p>Answer your question.</p></li>
</ol>
<p><br />
</p>
<p>1. Know your research question!</p>
<p>The researchers who collected this data wanted to understand how
decisions made the running of different Intensive Care Unit (ICU) wards
affected the prevalence of Multidrug Resistant <em>Staphylococcus
epidermidis</em> (MRSE, a relative of MRSA) amongst patients
(<code>mrse</code>). Given data was collected throughout all ICU wards
in the UK, the total number of patients in each ward varied by hospital
and was also recorded (<code>total_patients</code>). Specifically, the
researchers wanted to understand three explanatory variables: 1) the
number of staff working in an ICU (<code>staff</code>); 2) current
capacity of the ward (<code>capacity</code>, expressed as a proportion
of beds currently occupied, given the total number of beds); and 3)
whether or not the hospital board had implemented a policy concerning
the reduced use of Chlorhexidine bathing (<code>policy</code>), as the
researchers believed this bathing was, in part, responsible for
increasing prevalence of MRSE. Additionally, the researchers felt it was
likely that the effectiveness of the policy depended on the number of
staff available to implement it (so would require an interaction between
<code>staff</code> and <code>policy</code>). In total, data was
collected from 210 ICU wards (<span class="math inline">\(n =
210\)</span>), where each observation is from a single ICU ward in a
hospital.</p>
<p>As concisely as possible, write down the research question that can
be answered with our analysis.</p>
<p>2. Think about your response variable (the stochastic element).</p>
<p>From the information provided in the brief above, we are already able
to determine a suitable distribution to use when fitting the model (as
before, ignore that today’s class is called <span
class="math inline">\(Binomial\)</span> GLMs). Here, we’ve been told two
pieces of information that help us to figure it out.</p>
<ol style="list-style-type: decimal">
<li><p>We have a count of “successes” (here, “success” is a patient who
is infected with MRSE)</p></li>
<li><p>We have the total number of patients present on the
ward.</p></li>
</ol>
<p>So, we know the minimum count will be zero but we also know we have
an upper bound; We can’t have more patients infected with MRSE than we
have patients on the ward. While there would be nothing stopping us from
using a <span class="math inline">\(Poisson\)</span> distribution - as
it would handle to “count” aspect - it would not be useful for
addressing the upper bound (i.e. if we have 10 patients, the maximum
number of infected patients we could have would be 10). Instead, the
more appropriate distribution to use here would be a <span
class="math inline">\(Binomial\)</span> distribution to capture the
stochasticity of the data.</p>
<p><br />
</p>
<p>3. Think about the process behind the data (the deterministic
element).</p>
<p>As with yesterday’s practical, spending a couple of minutes thinking
about the process that goes into why some wards may have higher
prevalence of MRSE compared to others is mind boggling. We could spend
years trying to map out that complexity. Here, the researchers have
presented us with a suitably focused research question, so we can skip
the “existential crises” phase and jump straight into the modelling.
While skipping this is useful for teaching purposes, it really is worth
emphasising, again, that this is where the majority of statistical
analysis happens. Thinking very carefully about the process being
generating the data, and how we want to represent this in a model.</p>
<p> </p>
<p>4. Understand the data that you’ve collected (plot it!)</p>
<p>Import the data file ‘mrse.txt’ into R and take a look at the
structure of this dataframe. Given you have never seen this data before,
it’s really important that you familiarise yourself with any nuances. To
help with this, carry out an initial data exploration (using any methods
you think will help you get a sense of the data,
e.g. <code>plot()</code>, <code>pairs()</code>, <code>coplot()</code>,
amongst many other options).</p>
<p>Keep the tips and tricks you used in yesterday’s practical and feel
free to use them again here.</p>
<p>A bit of advice for visualising <span
class="math inline">\(Binomial\)</span> data; it can be easier to
visualise if you create a new column in your dataset which is the number
of successes, divided by the number of trials (using the terminology of
the <span class="math inline">\(Binomial\)</span> distribution). If in
doubt, as for help.</p>
<p>Also, do not feel as though you need to replicate the figures shown
here. They are included to show how <em>I</em> visualised the data, but
I am sure many of you will be able to do a better job. The figures shown
below are purely to give you inspiration.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>mrse<span class="sc">$</span>proportion <span class="ot">&lt;-</span> mrse<span class="sc">$</span>mrse <span class="sc">/</span> mrse<span class="sc">$</span>total_patients</span></code></pre></div>
<p> </p>
</div>
<div id="exercise-binomial-proportions-glm---mites-survival"
class="section level1">
<h1>Exercise: Binomial (Proportions) GLM - mites survival</h1>
<p> </p>
<p>The data for this exercise were collected for an experiment to test
the toxicity of different chemicals at various concentrations to a
species of mite. The aim was to determine whether the proportion of
mites surviving was related to the concentration of the chemical and
whether this relationship depended on the type of chemical the mites
were exposed to. We will be using a binomial GLM again for this example,
but this time we will be using it to model proportion data, from counts
of “successes” (= mite survival, unless you don’t like mites), and
“failures” (= mite death).</p>
<ul>
<li>Variables:
<ul>
<li><code>ID</code> index of the observations</li>
<li><code>Concentration</code>: Concentration of the chemical</li>
<li><code>Toxic</code>: Chemical type</li>
<li><code>Dead_mites</code>: Number of dead mites in assay</li>
<li><code>Total</code>: Initial number of mites in assay</li>
<li><code>Proportion</code>= <code>Dead_mites / Total</code></li>
</ul></li>
</ul>
<p> </p>
<p>As in previous exercises, either create a new R script (perhaps call
it GLM_BinomProps) or continue with your previous R script in your
RStudio Project. Again, make sure you include any metadata you feel is
appropriate (title, description of task, date of creation etc) and don’t
forget to comment out your metadata with a <code>#</code> at the
beginning of the line.</p>
<p> </p>
<p>1. Import the data file ‘DrugsMites.txt’ into R. We want to model the
variable Toxic as a categorical predictor with 4 levels, so create a new
variable with Toxic as a factor.</p>
<p> </p>
<p> </p>
<p>2. Perform the usual graphical data exploration, looking for
outliers, relationships between predictors, and between response and
predictors etc. You can use the variable <code>Proportion</code> in the
data frame for these plots.</p>
<p> </p>
<p> </p>
<p>3. In order to model the proportion of mites surviving, create a new
variable (called something creative like Living_mites for example)
representing the number of surviving mites by differencing the two
variables Dead_mites and Total.</p>
<p> </p>
<p> </p>
<p>4. We can now use this new variable when specifying a binomial GLM.
Recall from the lecture that the response variable should be a data
frame consisting of two columns, cbind(Living_mites, Dead_mites). Ask if
in doubt. If you hate mites you could also swap the order of the two
columns: you would then be modelling the proportion that die.</p>
<p> </p>
<p> </p>
<p>5. Obtain summaries of the model output using the
<code>summary()</code> function. Make sure you understand the
mathematical and biological interpretation of the model, by writing down
the complete model on paper (with distribution and link function). What
biological hypothesis does each term imply, qualitatively?</p>
<p> </p>
<p> </p>
<p>6. Do you need to check for overdispersion? If so, how do you do
it?</p>
<p> </p>
<p> </p>
<p>7. Do you need to perform model selection? What is the final
model?</p>
<p> </p>
<p> </p>
<p>8. Perform model validation: are you satisfied with the model?</p>
<p> </p>
<p> </p>
<p>9. Obtain the fitted values from the model on the scale of the
response, and plot to aid model interpretation. How do you interpret the
results?</p>
<p> </p>
<p> </p>
<p>10. (Optional) Include the 95 % CI on the plot above. You will need
to obtain the fitted values and SE on the scale of the link function,
calculate the CI and then back-transform.</p>
<p> </p>
<p> </p>
<p>End of the Binomial (Proportions) GLM - mites survival</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
