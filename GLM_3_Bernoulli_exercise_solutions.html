<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Day 3: Bernoulli GLMs</title>

<script src="site_libs/header-attrs-2.25/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">PGR-GLM</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="setup.html">
    <span class="fa fa-cog"></span>
     
    Setup
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    R Book
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://intro2r.com">
        <span class="fa fa-firefox"></span>
         
        Web book
      </a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="https://github.com/alexd106/Rbook/raw/master/docs/Rbook.pdf">
        <span class="fa fa-file-pdf"></span>
         
        PDF book
      </a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    Exercises
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="exercises.html">
        <span class="fa fa-book"></span>
         
        Exercises
      </a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="exercise_solutions.html">
        <span class="fa fa-book"></span>
         
        Exercise Solutions
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="data.html">
    <span class="fa fa-download"></span>
     
    Data
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-question-circle"></span>
     
    Info
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="syllabus.html">
        <span class="fa fa-graduation-cap"></span>
         
        Syllabus
      </a>
    </li>
    <li>
      <a href="People.html">
        <span class="fa fa-user-friends"></span>
         
        People
      </a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="resources.html">
        <span class="fa fa-book"></span>
         
        Resources
      </a>
    </li>
    <li class="dropdown-header">Feedback</li>
    <li>
      <a href="People.html">
        <span class="fa fa-envelope fa-lg"></span>
         
        Contact
      </a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="https://github.com/alexd106/PGR-GLM">
        <span class="fa fa-github fa-lg"></span>
         
        Source code
      </a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Day 3: Bernoulli GLMs</h1>

</div>


<p> </p>
<div
id="bernoulli-glm---predicting-if-netflix-users-will-watch-lord-of-the-rings-the-fellowship-of-the-ring"
class="section level1">
<h1>Bernoulli GLM - Predicting if Netflix users will watch Lord of the
Rings: The Fellowship of the Ring</h1>
<p> </p>
<p>For the GLM exercises, we’ll use the workflow we suggested in the
first GLM overview lecture as a template, specifically:</p>
<ol style="list-style-type: decimal">
<li><p>Know your research question!</p></li>
<li><p>Think about your response variable (stochastic).</p></li>
<li><p>Think about the process behind the data (deterministic).</p></li>
<li><p>Understand the data that you’ve collected (plot it!)</p></li>
<li><p>Combine into a model that can answer your question.</p></li>
<li><p>Fit the model.</p></li>
<li><p>Check your assumption(s).</p></li>
<li><p>Answer your question.</p></li>
</ol>
<p><br />
</p>
<div id="know-your-research-question" class="section level3">
<h3>1. Know your research question!</h3>
<p><br />
</p>
<p>For this final exercise, we’ll do something that’s, hopefully, a bit
fun and silly. We’re going to work with a relatively small Netflix
dataset, where we’re going to try and <em>predict</em> if a user will
will watch Lord of the Rings: The Fellowship of the Ring. I will admit
to a number of ulterior motivations in ending the course using this
dataset.</p>
<ol style="list-style-type: decimal">
<li><p>There is a common misconception that Machine Learning is for
predicting and Statistics is for understanding. I want to show that this
distinction is meaningless. In truth, machine learning is, in general,
statistics performed (or in some cases developed) by computer
scientists. For example, the GLMs you’ve learned to use on this course
are often called Supervised Machine Learning Models in Machine Learning
courses. The distinction between the two methods largely comes down to
who is teaching you (and who taught them). Indeed, some “classic”
machine learning methods such as Random Forest models are just GLMs with
a few extra bells and whistles in much the same way that some “classic”
statistical methods such as Mixed Effects models are just GLMs with a
few extra bells and whistles.</p></li>
<li><p>Because people tend to think of there being some sort of
distinction between Machine Learning and Statistics, it can result in
people, such as yourselves, not realising they have skill-sets that lots
of employers (including non-academic) are looking for. By using this
Netflix example I want to show that, having taken this course, your
employment options have broadened.</p></li>
<li><p>In the final and corresponding <span
class="math inline">\(Bernoulli\)</span> GLM lecture, I showed an
example where AIC fails miserably. In doing so, I’m at risk of leaving
you with the impression that AIC (and also other forms of model and
variable selection) should never be used. Therefore, in this exercise
we’re going to use an example where AIC is wonderfully well suited for
helping achieve our objective. It will also give me an opportunity to
talk a little more about how AIC works, and also the controversy and
differing opinions on AIC.</p></li>
<li><p>I really like Lord of the Rings.</p></li>
</ol>
<p>While this exercise takes on an industry focus, this is not specific
to <span class="math inline">\(Bernoulli\)</span> GLMs. Indeed, like all
GLMs and LMs, <span class="math inline">\(Bernoulli\)</span> GLMs can be
used for any of the three broad purposes we described in the first
lecture: Causal inference, prediction or description.</p>
<p>The data you’ve been provided includes various information that
Netflix has on hand about their users, for the purposes of predicting if
a user will watch Lord of the Rings (LoTR). To do so, our response
variable if whether not a given viewer watched LoTR (1) or not (0).</p>
<p>The covariates we have are: * <code>user</code> - a unique user ID *
<code>lotr</code> - if that user watched LoTR on Netflix *
<code>premium</code> - if the user has Netflix Premium or Standard *
<code>age</code> - the age of the user at the time of data collection *
<code>genre_likes</code> - how many fantasy films/shows the user had
previously liked * <code>actor_likes</code> - how many films/shows the
user had previously liked that included cast members of LoTR *
<code>similar_user_ratins</code> - what lotr of “similar” users had
liked LoTR (“similar” is undefined) * <code>mean_time_genre</code> -
what is the average length of time users watch fantasy media *
<code>user_time</code> - Time of day for user at time of data collection
(<code>Morning</code>, <code>Afternoon</code> and <code>Evening</code>)
* <code>user_day</code> - Day of week for user at time of data
collection (<code>Monday</code>, <code>Tuesday</code>, etc.) *
<code>user_device</code> - Type of device user was logged in from
(<code>TV</code>, <code>PC</code>, <code>Mobile Device</code> and
<code>Gaming Device</code>) * <code>fam_members</code> - Number of
family member accounts tied to subscription * <code>country</code> -
Country of subscription</p>
<p>As concisely as possible, write down the research question that can
be answered with our analysis, keeping in mind that Netflix are not
interested in understanding causation or writing a scientific paper,
they want predictive power.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Using the available covariates, can Lord of the Rings engagement be predicted and can we make this prediction as efficient as possible?</span></span></code></pre></div>
<p><br />
</p>
</div>
<div id="think-about-your-response-variable-the-stochastic-element."
class="section level3">
<h3>2. Think about your response variable (the stochastic element).</h3>
<p><br />
</p>
<p>From the information provided in the description above, we can
determine that a <span class="math inline">\(Bernoulli\)</span>
distribution is a sensible one to use here; our data is 0 (user did not
watch LoTR) or 1 (user did watch LoTR). Our stochastic element of the
model would therefore be:</p>
<p><span class="math inline">\(y_i \sim Bernoulli(p_i)\)</span></p>
<p>Where <span class="math inline">\(y\)</span> is if user <span
class="math inline">\(i\)</span> watched LoTR or not, generated
according to a <span class="math inline">\(Bernoulli\)</span>
distribution, with probability <span
class="math inline">\(p\)</span>.</p>
<p><br />
</p>
</div>
<div
id="think-about-the-process-behind-the-data-the-deterministic-element."
class="section level3">
<h3>3. Think about the process behind the data (the deterministic
element).</h3>
<p><br />
</p>
<p>Just like the drinking coffee example from the first lecture, the
<em>Data Generating Process</em> (DGP) for whether or not someone
watches a particular film on Netflix is going to be incredibly complex.
A nuance here is that our objective and intended use for this analysis
is prediction. When that’s the case, we can be a bit more relaxed about
understanding the deep complexity underlying the DGP and instead feel
relatively comfortable adding any and all covariates for which we have
data, with an important caveat. We must be confident that we are not
including any covariates which have no conceivable connection to our
response. For example, we wouldn’t want to include average sea surface
temperature because it shouldn’t give us any predictive power. But if
we’re unlucky, it may be correlated (by pure chance) with LoTR
viewership and thus we may think it helps us do predictions (see <a
href="https://www.tylervigen.com/spurious-correlations">this</a> website
for fun examples of such spurious correlations).</p>
<p>In this dataset, Netflix have collected covariates for the explicit
purpose of predicting viewership, so we can be confident that at least
<em>someone</em> thinks these variables might give us some predictive
power and aren’t spurious correlations.</p>
<p>With that said, our model will still have a deterministic equation
that describes the associations. Given how many variables we have it
would be cruel to task you with writing the equation out in full for a
model that contains all of those covariates. Instead, assume our model
was <code>lotr ~ age + user_time</code>. Use this simplified version of
the model to write out the equation that would underpin it. Note that
<code>age</code> is a continuous variable, and <code>user_time</code> is
a categorical variable with the levels <code>Morning</code>,
<code>Afternoon</code> and <code>Evening</code>.</p>
<p>For this equation, I’m not giving any hints so the difficulty does
spike here. If you’re struggling, ask for help. It really is worthwhile
learning how the syntax <code>lotr ~ age + user_time</code> is
translated into an equation, especially when you’re ready to go beyond
GLMs.</p>
<p><span class="math inline">\(logit(p_i) = \text{___}\)</span></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># With the blanks filled in, the equation should be:</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co"># logit(p_i) = beta_0 + beta_1 * Age_i + beta_2 * Evening_i + beta_3 * Morning_i</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co"># Why have I included Evening and then Morning, and not Afternoon?</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co"># Because R will take the level that appears first alphanumerically, and use </span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co"># that as the intercept (here *A*fternoon)</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co"># If we wanted Morning to be the reference level, what R code would we use?</span></span></code></pre></div>
<p> </p>
</div>
<div id="understand-the-data-that-youve-collected-plot-it"
class="section level3">
<h3>4. Understand the data that you’ve collected (plot it!)</h3>
<p><br />
</p>
<p>Import the data file ‘netflix.txt’ into R. Take a look at the
structure of the data and create plots that you feel will help you (and
others) understand the data.</p>
<p>Keep the tips and tricks you used in yesterday’s practical and feel
free to use them again here; load in the data, check for any covariates
you need to adjust, plot out the data, etc.</p>
<p>A bit of advice for visualising <span
class="math inline">\(Bernoulli\)</span> data; adding a little noise to
the x and y-axis values for each point (i.e. jittering) helps immensely
for visualising. To do so using <code>base</code> <code>R</code>, the
code would be:</p>
<pre><code>plot(jitter(my_data$y) ~ my_data$x)</code></pre>
<p>As in yesterday’s lecture and exercise, the my figures below are
produced using <code>ggplot2</code> and are included purely for
inspiration. I am also using an additional package,
<code>patchwork</code>, to stitch together multiple figures into a
single panel.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>netflix <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">file=</span> <span class="st">&quot;./data/netflix.txt&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co"># Change variables from characters to factors</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>netflix<span class="sc">$</span>user <span class="ot">&lt;-</span> <span class="fu">factor</span>(netflix<span class="sc">$</span>user)</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>netflix<span class="sc">$</span>premium <span class="ot">&lt;-</span> <span class="fu">factor</span>(netflix<span class="sc">$</span>premium)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>netflix<span class="sc">$</span>user_time <span class="ot">&lt;-</span> <span class="fu">factor</span>(netflix<span class="sc">$</span>user_time, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Morning&quot;</span>, <span class="st">&quot;Afternoon&quot;</span>, <span class="st">&quot;Evening&quot;</span>))</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>netflix<span class="sc">$</span>user_day <span class="ot">&lt;-</span> <span class="fu">factor</span>(netflix<span class="sc">$</span>user_day, </span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>                           <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Monday&quot;</span>, <span class="st">&quot;Tuesday&quot;</span>, <span class="st">&quot;Wednesday&quot;</span>, <span class="st">&quot;Thursday&quot;</span>, <span class="st">&quot;Friday&quot;</span>, <span class="st">&quot;Saturday&quot;</span>, <span class="st">&quot;Sunday&quot;</span>))</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a>netflix<span class="sc">$</span>user_device <span class="ot">&lt;-</span> <span class="fu">factor</span>(netflix<span class="sc">$</span>user_device)</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>netflix<span class="sc">$</span>country <span class="ot">&lt;-</span> <span class="fu">factor</span>(netflix<span class="sc">$</span>country)</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="fu">str</span>(netflix)</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="do">## &#39;data.frame&#39;:    15000 obs. of  13 variables:</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="do">##  $ user                : Factor w/ 15000 levels &quot;0014074f-9304-4349-b1df-565122630bfa&quot;,..: 13625 2447 4081 5075 12698 7275 2985 11444 44 2802 ...</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="do">##  $ lotr                : int  0 1 1 1 0 0 0 0 0 1 ...</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="do">##  $ premium             : Factor w/ 2 levels &quot;Premium&quot;,&quot;Standard&quot;: 2 2 2 2 2 2 2 2 2 1 ...</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="do">##  $ age                 : int  30 26 27 39 37 37 43 40 36 38 ...</span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="do">##  $ genre_likes         : int  2 2 2 2 0 2 1 5 2 5 ...</span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="do">##  $ actor_likes         : int  3 2 4 0 4 3 2 0 4 6 ...</span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="do">##  $ similar_user_ratings: num  0.62 0.67 0.92 0.75 0.46 0.59 0.77 0.62 0.67 0.54 ...</span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="do">##  $ mean_time_genre     : num  38.3 66.9 118.4 217.4 127.8 ...</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a><span class="do">##  $ user_time           : Factor w/ 3 levels &quot;Morning&quot;,&quot;Afternoon&quot;,..: 2 3 2 2 3 2 3 3 3 1 ...</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a><span class="do">##  $ user_day            : Factor w/ 7 levels &quot;Monday&quot;,&quot;Tuesday&quot;,..: 4 1 6 7 5 6 5 7 6 6 ...</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a><span class="do">##  $ user_device         : Factor w/ 4 levels &quot;Gaming Device&quot;,..: 4 4 4 4 4 4 4 4 1 2 ...</span></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a><span class="do">##  $ fam_members         : int  3 3 2 0 1 2 1 2 2 1 ...</span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a><span class="do">##  $ country             : Factor w/ 7 levels &quot;DE&quot;,&quot;FR&quot;,&quot;JP&quot;,..: 2 6 7 5 7 6 2 6 6 4 ...</span></span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a><span class="co"># &#39;data.frame&#39;: 15000 obs. of  13 variables:</span></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a><span class="co">#  $ user                : Factor w/ 15000 levels &quot;0014074f-9304-4349-b1df-565122630bfa&quot;,..: 13625 2447 4081 ...</span></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a><span class="co">#  $ lotr                : int  0 1 1 1 0 0 0 0 0 1 ...</span></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a><span class="co">#  $ premium             : Factor w/ 2 levels &quot;Premium&quot;,&quot;Standard&quot;: 2 2 2 2 2 2 2 2 2 1 ...</span></span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a><span class="co">#  $ age                 : int  30 26 27 39 37 37 43 40 36 38 ...</span></span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a><span class="co">#  $ genre_likes         : int  2 2 2 2 0 2 1 5 2 5 ...</span></span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a><span class="co">#  $ actor_likes         : int  3 2 4 0 4 3 2 0 4 6 ...</span></span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a><span class="co">#  $ similar_user_ratings: num  0.62 0.67 0.92 0.75 0.46 0.59 0.77 0.62 0.67 0.54 ...</span></span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a><span class="co">#  $ mean_time_genre     : num  38.3 66.9 118.4 217.4 127.8 ...</span></span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a><span class="co">#  $ user_time           : Factor w/ 3 levels &quot;Afternoon&quot;,&quot;Evening&quot;,..: 1 2 1 1 2 1 2 2 2 3 ...</span></span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a><span class="co">#  $ user_day            : Factor w/ 7 levels &quot;Friday&quot;,&quot;Monday&quot;,..: 5 2 3 4 1 3 1 4 3 3 ...</span></span>
<span id="cb4-38"><a href="#cb4-38" tabindex="-1"></a><span class="co">#  $ user_device         : Factor w/ 4 levels &quot;Gaming Device&quot;,..: 4 4 4 4 4 4 4 4 1 2 ...</span></span>
<span id="cb4-39"><a href="#cb4-39" tabindex="-1"></a><span class="co">#  $ fam_members         : int  3 3 2 0 1 2 1 2 2 1 ...</span></span>
<span id="cb4-40"><a href="#cb4-40" tabindex="-1"></a><span class="co">#  $ country             : Factor w/ 7 levels &quot;DE&quot;,&quot;FR&quot;,&quot;JP&quot;,..: 2 6 7 5 7 6 2 6 6 4 ...</span></span>
<span id="cb4-41"><a href="#cb4-41" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" tabindex="-1"></a><span class="fu">summary</span>(netflix)</span>
<span id="cb4-43"><a href="#cb4-43" tabindex="-1"></a><span class="do">##                                    user            lotr            premium     </span></span>
<span id="cb4-44"><a href="#cb4-44" tabindex="-1"></a><span class="do">##  0014074f-9304-4349-b1df-565122630bfa:    1   Min.   :0.0000   Premium : 3001  </span></span>
<span id="cb4-45"><a href="#cb4-45" tabindex="-1"></a><span class="do">##  0017781d-22a6-41d1-9c61-10427b20f846:    1   1st Qu.:0.0000   Standard:11999  </span></span>
<span id="cb4-46"><a href="#cb4-46" tabindex="-1"></a><span class="do">##  001f0d02-282e-4812-87b3-723e978da027:    1   Median :1.0000                   </span></span>
<span id="cb4-47"><a href="#cb4-47" tabindex="-1"></a><span class="do">##  0021ddf2-ef09-4abe-b27d-d3fa74fd92b7:    1   Mean   :0.5278                   </span></span>
<span id="cb4-48"><a href="#cb4-48" tabindex="-1"></a><span class="do">##  0023c3d4-ba8f-4716-8c30-6d6859c77b85:    1   3rd Qu.:1.0000                   </span></span>
<span id="cb4-49"><a href="#cb4-49" tabindex="-1"></a><span class="do">##  00295ab4-6930-4d7e-b678-b10a65c0f234:    1   Max.   :1.0000                   </span></span>
<span id="cb4-50"><a href="#cb4-50" tabindex="-1"></a><span class="do">##  (Other)                             :14994                                    </span></span>
<span id="cb4-51"><a href="#cb4-51" tabindex="-1"></a><span class="do">##       age         genre_likes     actor_likes     similar_user_ratings</span></span>
<span id="cb4-52"><a href="#cb4-52" tabindex="-1"></a><span class="do">##  Min.   : 7.00   Min.   :0.000   Min.   : 0.000   Min.   :0.0300      </span></span>
<span id="cb4-53"><a href="#cb4-53" tabindex="-1"></a><span class="do">##  1st Qu.:24.00   1st Qu.:1.000   1st Qu.: 2.000   1st Qu.:0.5300      </span></span>
<span id="cb4-54"><a href="#cb4-54" tabindex="-1"></a><span class="do">##  Median :29.00   Median :2.000   Median : 3.000   Median :0.6900      </span></span>
<span id="cb4-55"><a href="#cb4-55" tabindex="-1"></a><span class="do">##  Mean   :29.98   Mean   :1.998   Mean   : 2.973   Mean   :0.6661      </span></span>
<span id="cb4-56"><a href="#cb4-56" tabindex="-1"></a><span class="do">##  3rd Qu.:35.00   3rd Qu.:3.000   3rd Qu.: 4.000   3rd Qu.:0.8300      </span></span>
<span id="cb4-57"><a href="#cb4-57" tabindex="-1"></a><span class="do">##  Max.   :79.00   Max.   :9.000   Max.   :12.000   Max.   :1.0000      </span></span>
<span id="cb4-58"><a href="#cb4-58" tabindex="-1"></a><span class="do">##                                                                       </span></span>
<span id="cb4-59"><a href="#cb4-59" tabindex="-1"></a><span class="do">##  mean_time_genre     user_time         user_day           user_device   </span></span>
<span id="cb4-60"><a href="#cb4-60" tabindex="-1"></a><span class="do">##  Min.   :  0.0   Morning  :1477   Monday   :1698   Gaming Device: 1535  </span></span>
<span id="cb4-61"><a href="#cb4-61" tabindex="-1"></a><span class="do">##  1st Qu.: 79.9   Afternoon:4419   Tuesday  :1352   Mobile Device: 2066  </span></span>
<span id="cb4-62"><a href="#cb4-62" tabindex="-1"></a><span class="do">##  Median :120.1   Evening  :9104   Wednesday:1479   PC           : 1223  </span></span>
<span id="cb4-63"><a href="#cb4-63" tabindex="-1"></a><span class="do">##  Mean   :120.5                    Thursday :1805   TV           :10176  </span></span>
<span id="cb4-64"><a href="#cb4-64" tabindex="-1"></a><span class="do">##  3rd Qu.:160.3                    Friday   :2724                        </span></span>
<span id="cb4-65"><a href="#cb4-65" tabindex="-1"></a><span class="do">##  Max.   :344.2                    Saturday :2792                        </span></span>
<span id="cb4-66"><a href="#cb4-66" tabindex="-1"></a><span class="do">##                                   Sunday   :3150                        </span></span>
<span id="cb4-67"><a href="#cb4-67" tabindex="-1"></a><span class="do">##   fam_members    country  </span></span>
<span id="cb4-68"><a href="#cb4-68" tabindex="-1"></a><span class="do">##  Min.   :0.000   DE:2476  </span></span>
<span id="cb4-69"><a href="#cb4-69" tabindex="-1"></a><span class="do">##  1st Qu.:1.000   FR:2119  </span></span>
<span id="cb4-70"><a href="#cb4-70" tabindex="-1"></a><span class="do">##  Median :2.000   JP: 302  </span></span>
<span id="cb4-71"><a href="#cb4-71" tabindex="-1"></a><span class="do">##  Mean   :1.992   MX:1753  </span></span>
<span id="cb4-72"><a href="#cb4-72" tabindex="-1"></a><span class="do">##  3rd Qu.:3.000   NZ: 728  </span></span>
<span id="cb4-73"><a href="#cb4-73" tabindex="-1"></a><span class="do">##  Max.   :9.000   UK:2825  </span></span>
<span id="cb4-74"><a href="#cb4-74" tabindex="-1"></a><span class="do">##                  US:4797</span></span>
<span id="cb4-75"><a href="#cb4-75" tabindex="-1"></a> <span class="co">#                                   user            lotr            premium           age         genre_likes   </span></span>
<span id="cb4-76"><a href="#cb4-76" tabindex="-1"></a> <span class="co"># 0014074f-9304-4349-b1df-565122630bfa:    1   Min.   :0.0000   Premium : 3001   Min.   : 7.00   Min.   :0.000  </span></span>
<span id="cb4-77"><a href="#cb4-77" tabindex="-1"></a> <span class="co"># 0017781d-22a6-41d1-9c61-10427b20f846:    1   1st Qu.:0.0000   Standard:11999   1st Qu.:24.00   1st Qu.:1.000  </span></span>
<span id="cb4-78"><a href="#cb4-78" tabindex="-1"></a> <span class="co"># 001f0d02-282e-4812-87b3-723e978da027:    1   Median :1.0000                    Median :29.00   Median :2.000  </span></span>
<span id="cb4-79"><a href="#cb4-79" tabindex="-1"></a> <span class="co"># 0021ddf2-ef09-4abe-b27d-d3fa74fd92b7:    1   Mean   :0.5278                    Mean   :29.98   Mean   :1.998  </span></span>
<span id="cb4-80"><a href="#cb4-80" tabindex="-1"></a> <span class="co"># 0023c3d4-ba8f-4716-8c30-6d6859c77b85:    1   3rd Qu.:1.0000                    3rd Qu.:35.00   3rd Qu.:3.000  </span></span>
<span id="cb4-81"><a href="#cb4-81" tabindex="-1"></a> <span class="co"># 00295ab4-6930-4d7e-b678-b10a65c0f234:    1   Max.   :1.0000                    Max.   :79.00   Max.   :9.000  </span></span>
<span id="cb4-82"><a href="#cb4-82" tabindex="-1"></a> <span class="co"># (Other)                             :14994                                                                    </span></span>
<span id="cb4-83"><a href="#cb4-83" tabindex="-1"></a> <span class="co">#  actor_likes     similar_user_ratings mean_time_genre     user_time         user_day           user_device   </span></span>
<span id="cb4-84"><a href="#cb4-84" tabindex="-1"></a> <span class="co"># Min.   : 0.000   Min.   :0.0300       Min.   :  0.0   Afternoon:4419   Friday   :2724   Gaming Device: 1535  </span></span>
<span id="cb4-85"><a href="#cb4-85" tabindex="-1"></a> <span class="co"># 1st Qu.: 2.000   1st Qu.:0.5300       1st Qu.: 79.9   Evening  :9104   Monday   :1698   Mobile Device: 2066  </span></span>
<span id="cb4-86"><a href="#cb4-86" tabindex="-1"></a> <span class="co"># Median : 3.000   Median :0.6900       Median :120.1   Morning  :1477   Saturday :2792   PC           : 1223  </span></span>
<span id="cb4-87"><a href="#cb4-87" tabindex="-1"></a> <span class="co"># Mean   : 2.973   Mean   :0.6661       Mean   :120.5                    Sunday   :3150   TV           :10176  </span></span>
<span id="cb4-88"><a href="#cb4-88" tabindex="-1"></a> <span class="co"># 3rd Qu.: 4.000   3rd Qu.:0.8300       3rd Qu.:160.3                    Thursday :1805                        </span></span>
<span id="cb4-89"><a href="#cb4-89" tabindex="-1"></a> <span class="co"># Max.   :12.000   Max.   :1.0000       Max.   :344.2                    Tuesday  :1352                        </span></span>
<span id="cb4-90"><a href="#cb4-90" tabindex="-1"></a> <span class="co">#                                                                        Wednesday:1479                        </span></span>
<span id="cb4-91"><a href="#cb4-91" tabindex="-1"></a> <span class="co">#  fam_members    country  </span></span>
<span id="cb4-92"><a href="#cb4-92" tabindex="-1"></a> <span class="co"># Min.   :0.000   DE:2476  </span></span>
<span id="cb4-93"><a href="#cb4-93" tabindex="-1"></a> <span class="co"># 1st Qu.:1.000   FR:2119  </span></span>
<span id="cb4-94"><a href="#cb4-94" tabindex="-1"></a> <span class="co"># Median :2.000   JP: 302  </span></span>
<span id="cb4-95"><a href="#cb4-95" tabindex="-1"></a> <span class="co"># Mean   :1.992   MX:1753  </span></span>
<span id="cb4-96"><a href="#cb4-96" tabindex="-1"></a> <span class="co"># 3rd Qu.:3.000   NZ: 728  </span></span>
<span id="cb4-97"><a href="#cb4-97" tabindex="-1"></a> <span class="co"># Max.   :9.000   UK:2825  </span></span>
<span id="cb4-98"><a href="#cb4-98" tabindex="-1"></a> <span class="co">#                 US:4797  </span></span>
<span id="cb4-99"><a href="#cb4-99" tabindex="-1"></a></span>
<span id="cb4-100"><a href="#cb4-100" tabindex="-1"></a><span class="co"># install.packages(&quot;ggplot2&quot;) # Run this line of code if you do not have ggplot installed</span></span>
<span id="cb4-101"><a href="#cb4-101" tabindex="-1"></a><span class="co"># Once installed, load the package</span></span>
<span id="cb4-102"><a href="#cb4-102" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb4-103"><a href="#cb4-103" tabindex="-1"></a></span>
<span id="cb4-104"><a href="#cb4-104" tabindex="-1"></a><span class="co"># I&#39;ll use another package called `patchwork` that helps combine ggplot figure together</span></span>
<span id="cb4-105"><a href="#cb4-105" tabindex="-1"></a><span class="co"># install.packages(&quot;patchwork&quot;) # Run this line of code if you do not have patchwork installed</span></span>
<span id="cb4-106"><a href="#cb4-106" tabindex="-1"></a><span class="co"># Once installed, load the package</span></span>
<span id="cb4-107"><a href="#cb4-107" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb4-108"><a href="#cb4-108" tabindex="-1"></a></span>
<span id="cb4-109"><a href="#cb4-109" tabindex="-1"></a><span class="co"># Not needed but downloading netflix icon to add to figure to give that corporate feel</span></span>
<span id="cb4-110"><a href="#cb4-110" tabindex="-1"></a><span class="co"># If you want to do this, you&#39;ll need to install the `png` package</span></span>
<span id="cb4-111"><a href="#cb4-111" tabindex="-1"></a><span class="fu">library</span>(png)</span>
<span id="cb4-112"><a href="#cb4-112" tabindex="-1"></a>logo <span class="ot">&lt;-</span> <span class="fu">readPNG</span>(<span class="st">&quot;./images/netflix.png&quot;</span>)</span>
<span id="cb4-113"><a href="#cb4-113" tabindex="-1"></a></span>
<span id="cb4-114"><a href="#cb4-114" tabindex="-1"></a><span class="co"># Bar chart showing total number of views according to account type</span></span>
<span id="cb4-115"><a href="#cb4-115" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(netflix) <span class="sc">+</span></span>
<span id="cb4-116"><a href="#cb4-116" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> premium, <span class="at">y =</span> lotr), <span class="at">linetype =</span> <span class="dv">1</span>,</span>
<span id="cb4-117"><a href="#cb4-117" tabindex="-1"></a>           <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">colour =</span> <span class="st">&quot;#E50914&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-118"><a href="#cb4-118" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Subscription type&quot;</span>,</span>
<span id="cb4-119"><a href="#cb4-119" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Total number of</span><span class="sc">\n</span><span class="st">Lord of The Rings views&quot;</span>) <span class="sc">+</span>  </span>
<span id="cb4-120"><a href="#cb4-120" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb4-121"><a href="#cb4-121" tabindex="-1"></a>  <span class="fu">annotation_raster</span>(logo, </span>
<span id="cb4-122"><a href="#cb4-122" tabindex="-1"></a>                    <span class="at">xmin =</span> <span class="fl">0.5</span>, <span class="at">xmax =</span> <span class="dv">1</span>,</span>
<span id="cb4-123"><a href="#cb4-123" tabindex="-1"></a>                    <span class="at">ymin =</span> <span class="dv">4000</span>, <span class="at">ymax =</span> <span class="dv">6000</span>)</span>
<span id="cb4-124"><a href="#cb4-124" tabindex="-1"></a></span>
<span id="cb4-125"><a href="#cb4-125" tabindex="-1"></a><span class="co"># A scatterplot for lotr ~ age, jittered</span></span>
<span id="cb4-126"><a href="#cb4-126" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(netflix) <span class="sc">+</span></span>
<span id="cb4-127"><a href="#cb4-127" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> lotr), </span>
<span id="cb4-128"><a href="#cb4-128" tabindex="-1"></a>              <span class="at">width =</span> <span class="dv">0</span>, <span class="at">height =</span> <span class="fl">0.3</span>,</span>
<span id="cb4-129"><a href="#cb4-129" tabindex="-1"></a>              <span class="at">colour =</span> <span class="st">&quot;#E50914&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb4-130"><a href="#cb4-130" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(y) <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;No&quot;</span>, <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;Yes&quot;</span>, y)),</span>
<span id="cb4-131"><a href="#cb4-131" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb4-132"><a href="#cb4-132" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;User age&quot;</span>,</span>
<span id="cb4-133"><a href="#cb4-133" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Viewed</span><span class="sc">\n</span><span class="st">Lord of The Rings&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-134"><a href="#cb4-134" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb4-135"><a href="#cb4-135" tabindex="-1"></a></span>
<span id="cb4-136"><a href="#cb4-136" tabindex="-1"></a><span class="co"># A scatterplot for lotr ~ genre_likes, jittered</span></span>
<span id="cb4-137"><a href="#cb4-137" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(netflix) <span class="sc">+</span></span>
<span id="cb4-138"><a href="#cb4-138" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> genre_likes, <span class="at">y =</span> lotr), </span>
<span id="cb4-139"><a href="#cb4-139" tabindex="-1"></a>              <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">height =</span> <span class="fl">0.3</span>,</span>
<span id="cb4-140"><a href="#cb4-140" tabindex="-1"></a>              <span class="at">colour =</span> <span class="st">&quot;#E50914&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb4-141"><a href="#cb4-141" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(y) <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;No&quot;</span>, <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;Yes&quot;</span>, y)),</span>
<span id="cb4-142"><a href="#cb4-142" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb4-143"><a href="#cb4-143" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Number of fantasy likes&quot;</span>,</span>
<span id="cb4-144"><a href="#cb4-144" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Viewed</span><span class="sc">\n</span><span class="st">Lord of The Rings&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-145"><a href="#cb4-145" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb4-146"><a href="#cb4-146" tabindex="-1"></a></span>
<span id="cb4-147"><a href="#cb4-147" tabindex="-1"></a><span class="co"># A scatterplot for lotr ~ actor_likes, jittered</span></span>
<span id="cb4-148"><a href="#cb4-148" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(netflix) <span class="sc">+</span></span>
<span id="cb4-149"><a href="#cb4-149" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> actor_likes, <span class="at">y =</span> lotr), </span>
<span id="cb4-150"><a href="#cb4-150" tabindex="-1"></a>              <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">height =</span> <span class="fl">0.3</span>,</span>
<span id="cb4-151"><a href="#cb4-151" tabindex="-1"></a>              <span class="at">colour =</span> <span class="st">&quot;#E50914&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb4-152"><a href="#cb4-152" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(y) <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;No&quot;</span>, <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;Yes&quot;</span>, y)),</span>
<span id="cb4-153"><a href="#cb4-153" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb4-154"><a href="#cb4-154" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Number of films with same actor liked&quot;</span>,</span>
<span id="cb4-155"><a href="#cb4-155" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Viewed</span><span class="sc">\n</span><span class="st">Lord of The Rings&quot;</span>) <span class="sc">+</span></span>
<span id="cb4-156"><a href="#cb4-156" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb4-157"><a href="#cb4-157" tabindex="-1"></a></span>
<span id="cb4-158"><a href="#cb4-158" tabindex="-1"></a><span class="co"># Using the patchwork package I stich p1 to p4 together into a single figure</span></span>
<span id="cb4-159"><a href="#cb4-159" tabindex="-1"></a>(p1 <span class="sc">+</span> p2) <span class="sc">/</span> (p3 <span class="sc">+</span> p4)</span></code></pre></div>
<p><img src="GLM_3_Bernoulli_exercise_solutions_files/figure-html/Q4-1.png" width="672" /></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co"># A scatterplot for lotr ~ similar_user_ratings, jittered</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(netflix) <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> similar_user_ratings, <span class="at">y =</span> lotr), </span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>              <span class="at">width =</span> <span class="dv">0</span>, <span class="at">height =</span> <span class="fl">0.3</span>,</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>              <span class="at">colour =</span> <span class="st">&quot;#E50914&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(y) <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;No&quot;</span>, <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;Yes&quot;</span>, y)),</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Proportion of similar users who liked LoTR&quot;</span>,</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Viewed</span><span class="sc">\n</span><span class="st">Lord of The Rings&quot;</span>) <span class="sc">+</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="co"># A scatterplot for lotr ~ mean_time_genre, jittered</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(netflix) <span class="sc">+</span></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean_time_genre, <span class="at">y =</span> lotr), </span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>              <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">height =</span> <span class="fl">0.3</span>,</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>              <span class="at">colour =</span> <span class="st">&quot;#E50914&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(y) <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;No&quot;</span>, <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;Yes&quot;</span>, y)),</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Mean time spent watching fantasy films&quot;</span>,</span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Viewed</span><span class="sc">\n</span><span class="st">Lord of The Rings&quot;</span>) <span class="sc">+</span></span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a><span class="co"># A scatterplot for lotr ~ user_time, jittered</span></span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a>p7 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(netflix) <span class="sc">+</span></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> user_time, <span class="at">y =</span> lotr), </span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a>              <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">height =</span> <span class="fl">0.3</span>,</span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a>              <span class="at">colour =</span> <span class="st">&quot;#E50914&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(y) <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;No&quot;</span>, <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;Yes&quot;</span>, y)),</span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time of day&quot;</span>,</span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Viewed</span><span class="sc">\n</span><span class="st">Lord of The Rings&quot;</span>) <span class="sc">+</span></span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a></span>
<span id="cb5-36"><a href="#cb5-36" tabindex="-1"></a><span class="co"># A scatterplot for lotr ~ user_day, jittered</span></span>
<span id="cb5-37"><a href="#cb5-37" tabindex="-1"></a>p8 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(netflix) <span class="sc">+</span></span>
<span id="cb5-38"><a href="#cb5-38" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> user_day, <span class="at">y =</span> lotr), </span>
<span id="cb5-39"><a href="#cb5-39" tabindex="-1"></a>              <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">height =</span> <span class="fl">0.3</span>,</span>
<span id="cb5-40"><a href="#cb5-40" tabindex="-1"></a>              <span class="at">colour =</span> <span class="st">&quot;#E50914&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb5-41"><a href="#cb5-41" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(y) <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;No&quot;</span>, <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;Yes&quot;</span>, y)),</span>
<span id="cb5-42"><a href="#cb5-42" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb5-43"><a href="#cb5-43" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Day of week&quot;</span>,</span>
<span id="cb5-44"><a href="#cb5-44" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Viewed</span><span class="sc">\n</span><span class="st">Lord of The Rings&quot;</span>) <span class="sc">+</span></span>
<span id="cb5-45"><a href="#cb5-45" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb5-46"><a href="#cb5-46" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">30</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="fl">0.3</span>))</span>
<span id="cb5-47"><a href="#cb5-47" tabindex="-1"></a></span>
<span id="cb5-48"><a href="#cb5-48" tabindex="-1"></a></span>
<span id="cb5-49"><a href="#cb5-49" tabindex="-1"></a><span class="co"># Using the patchwork package I stich p1 to p4 together into a single figure</span></span>
<span id="cb5-50"><a href="#cb5-50" tabindex="-1"></a>(p5 <span class="sc">+</span> p6) <span class="sc">/</span> (p7 <span class="sc">+</span> p8)</span></code></pre></div>
<p><img src="GLM_3_Bernoulli_exercise_solutions_files/figure-html/Q4-2.png" width="672" /></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co"># A scatterplot for lotr ~ fam_members, jittered</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>p9 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(netflix) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>    <span class="fu">annotation_raster</span>(logo,</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>                      <span class="at">xmin =</span> <span class="fl">8.3</span>, <span class="at">xmax =</span> <span class="fl">9.6</span>,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>                      <span class="at">ymin =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">ymax =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> fam_members, <span class="at">y =</span> lotr), </span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>              <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">height =</span> <span class="fl">0.3</span>,</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>              <span class="at">colour =</span> <span class="st">&quot;#E50914&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(y) <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;No&quot;</span>, <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;Yes&quot;</span>, y)),</span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Number of accounts&quot;</span>,</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Viewed</span><span class="sc">\n</span><span class="st">Lord of The Rings&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>  </span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co"># A scatterplot for lotr ~ user_device, jittered</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>p10 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(netflix) <span class="sc">+</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> user_device, <span class="at">y =</span> lotr), </span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>              <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">height =</span> <span class="fl">0.3</span>,</span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>              <span class="at">colour =</span> <span class="st">&quot;#E50914&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(y) <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;No&quot;</span>, <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;Yes&quot;</span>, y)),</span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;User device&quot;</span>,</span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Viewed</span><span class="sc">\n</span><span class="st">Lord of The Rings&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a><span class="co"># A scatterplot for lotr ~ country, jittered</span></span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a>p11 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(netflix) <span class="sc">+</span></span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> country, <span class="at">y =</span> lotr), </span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a>              <span class="at">width =</span> <span class="fl">0.3</span>, <span class="at">height =</span> <span class="fl">0.3</span>,</span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a>              <span class="at">colour =</span> <span class="st">&quot;#E50914&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>) <span class="sc">+</span></span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(y) <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;No&quot;</span>, <span class="fu">ifelse</span>(y <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;Yes&quot;</span>, y)),</span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Country of registration&quot;</span>,</span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Viewed</span><span class="sc">\n</span><span class="st">Lord of The Rings&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb6-37"><a href="#cb6-37" tabindex="-1"></a></span>
<span id="cb6-38"><a href="#cb6-38" tabindex="-1"></a><span class="co"># Using the patchwork package I stich p1 to p4 together into a single figure</span></span>
<span id="cb6-39"><a href="#cb6-39" tabindex="-1"></a>(p10 <span class="sc">+</span> p11) <span class="sc">/</span> p9</span></code></pre></div>
<p><img src="GLM_3_Bernoulli_exercise_solutions_files/figure-html/Q4-3.png" width="672" /></p>
<p><br />
</p>
</div>
<div id="combine-into-a-model-that-can-answer-your-question."
class="section level3">
<h3>5. Combine into a model that can answer your question.</h3>
<p><br />
</p>
<p>Having gone through the previous steps, it’s now time to run our
model. Keep in mind that with this model, our objective is prediction,
so we’ll be running a model that includes all available covariates
excluding one; <code>user_id</code> as including just this one covariate
will require <strong>15,000</strong> parameters be estimated. We don’t
want that, nor do we have the sample size to support it.</p>
<p>Run the full model (not including <code>user_id</code>), using
<code>glm()</code>.</p>
<ul>
<li>Hints:
<ul>
<li>Because <span class="math inline">\(Bernoulli\)</span> is really
just a special case of the <span class="math inline">\(Binomial\)</span>
distribution, we specify <code>family = binomial</code></li>
<li>Do we need to specify number of success and number of failures like
we did for <span class="math inline">\(Binomial\)</span> GLMs?</li>
<li>What is the default link function used by <span
class="math inline">\(Bernoulli\)</span> GLMs?</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(lotr <span class="sc">~</span> premium <span class="sc">+</span> age <span class="sc">+</span> genre_likes <span class="sc">+</span> actor_likes <span class="sc">+</span> similar_user_ratings <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>              mean_time_genre <span class="sc">+</span> user_time <span class="sc">+</span> user_day <span class="sc">+</span> user_device <span class="sc">+</span> fam_members <span class="sc">+</span> country, </span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), </span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>            <span class="at">data =</span> netflix)</span></code></pre></div>
<p><br />
</p>
</div>
<div id="variable-selection" class="section level3">
<h3>6. Variable selection</h3>
<p>Given that in the lecture I showed an instance where AIC and variable
selection failed quite miserably, in this exercise, I wanted to include
a scenario where it performs very well.</p>
<p>Note that this discussion below is also true for Likelihood Ratio
Testing (LRT). In fact, AIC ends up being the equivalent to LRT, where
the P-value threshold to 0.187 rather than 0.05 (see Sutherland et al.,
<a href="https://doi.org/10.1098/rspb.2023.1261%5D">2023</a>).</p>
<p>For that, we need to have a brief discussion about how AIC works,
starting with how it is calculated:</p>
<p><span class="math inline">\(AIC = 2K -
2ln(\mathcal{\hat{L}})\)</span></p>
<p>where <span class="math inline">\(K\)</span> is the number of
parameters in our model, <span class="math inline">\(ln\)</span> is the
natural log, and <span class="math inline">\(\mathcal{\hat{L}}\)</span>
is the maximum likelihood value for our given model. (Note that in
practice <span class="math inline">\(-2ln(\mathcal{\hat{L}})\)</span> is
used in model fitting for reasons that are not important here).</p>
<p>Think back to the <span class="math inline">\(Poisson\)</span> GLM
lecture where we walked through how <span
class="math inline">\(\mathcal{\hat{L}}\)</span> was derived. In that
example, we were just trying different values for each parameter until
we hit the “sweet spot” - where our predicted values were closest to our
observed values using a particular combination of parameter values.
Basically, <span class="math inline">\(\mathcal{\hat{L}}\)</span> is a
value that reflects how well a combination of parameter values results
in predicted values that are as close as possible to our actual response
variable.</p>
<p>Where AIC comes in, is that it uses this <span
class="math inline">\(\mathcal{\hat{L}}\)</span> value and asks; “Are
all of these parameters needed to get to the best fit?” That’s why AIC
include the <span class="math inline">\(2K\)</span> bit. Each parameter
has a “cost” associated with it of <span class="math inline">\(+2
AIC\)</span> units; AIC is a fit-versus-cost trade-off. If the cost of
including a parameter in our model does not sufficiently improve our
likelihood, then it is considered to be uninformative, and AIC tells us
it’s not worth including in the model. The conventional threshold is
that if the difference when removing a variable from a model is less
than or equal to <span class="math inline">\(2 \Delta AIC\)</span>
(where <span class="math inline">\(\Delta\)</span> just means
difference), then the covariate can be removed.</p>
<p>Going through this process, we are left with the most parsimonious
model; the model that has a desired level of accuracy (or prediction)
that uses the fewest variables as possible to do so. This is why some
statisticians (myself included) tend to think of AIC as a “with-in
sample predictive” tool. (Contrast this with “out-of sample prediction”
where we use a new dataset to see how well our model predicts the
response variable of that <em>new</em> dataset.) All that means is; AIC
is a tool that evaluates the predictive ability of a model, in
predicting the data that you used to fit the model. With this view of
AIC, a parsimonious model simply represents a model that has “good”
predictive ability. Importantly, however, such models are not intended
to offer insights into causation. Indeed, for causal inference, AIC can
be quite harmful.</p>
<p>For example, consider the following scenario. We are interested in
the association between ice cream sales and shark attacks. There is no
direct causal relationship between these two variables. Instead, it is
the number of beach visitors that determines <em>both</em> ice cream
sales and shark attacks.</p>
<p>Regardless of causal mechanisms, finding a set of parameter values
that captures the association between ice cream sales and shark attacks
is trivial for <code>glm()</code>. This is what <code>glm()</code> is
designed to do after all - estimate associations. If we were to use AIC
on this hypothetical model it would strongly support including ice cream
sales in the model, because knowing how many ice creams have been sold
is pretty much telling us how many people were at the beach.</p>
<p>Test it out if your skeptical:</p>
<pre><code>set.seed(123) # set seed so results are consistent
N &lt;- 200 # 200 beaches
visitors &lt;- rpois(N, lambda = 10) # generate 200 visitor counts
# Note that icecream does not appear when simulating shark, just visitors
shark &lt;- rbinom(N, size = 1, prob = plogis(-4 + 0.2 * visitors)) # shark attack
# Note that shark does not appear when simulating icecream, just visitors
icecream &lt;- rpois(N, lambda = exp(-5 + 0.5 * visitors)) # number of ice creams
dat &lt;- data.frame(visitors, shark, icecream) # combine into dataset
mod1 &lt;- glm(shark ~ icecream, family = binomial, data = dat) # run bernoulli glm
drop1(mod1) # use AIC to do variable selection
# AIC of full model: 167.29
# AIC of model without icecream: 171.08</code></pre>
<p>The upside of this is that including <code>icecream</code> is very
useful if we want to make predictions of shark attacks. For example, if
there are two beaches, the first with very few ice cream sales, and the
second with lots. Which beach is more at risk of shark attacks? Clearly
we can predict the second beach is at higher risk, we just don’t know
<em>why</em> (based on the model).</p>
<p>With that in mind, my view is that AIC is most useful, and least
risky, when used for prediction modelling. There are alternatives to
AIC, but AIC is still useful never-the-less. Let’s use AIC and variable
selection now in order to determine which covariates give us predictive
power, and which we can simply ignore when trying to make accurate
predictions.</p>
<p>Starting off with the full model and using <code>drop1()</code>,
which covariates can be removed without reducing our predictive
power?</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">drop1</span>(mod1)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="do">## Single term deletions</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="do">## Model:</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="do">## lotr ~ premium + age + genre_likes + actor_likes + similar_user_ratings + </span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="do">##     mean_time_genre + user_time + user_day + user_device + fam_members + </span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="do">##     country</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="do">##                      Df Deviance     AIC</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="do">## &lt;none&gt;                    8535.3  8585.3</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="do">## premium               1   8535.3  8583.3</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="do">## age                   1  14997.9 15045.9</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="do">## genre_likes           1   8576.9  8624.9</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="do">## actor_likes           1   8552.1  8600.1</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="do">## similar_user_ratings  1  15360.9 15408.9</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="do">## mean_time_genre       1  10091.2 10139.2</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="do">## user_time             2   8677.9  8723.9</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="do">## user_day              6   9012.2  9050.2</span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="do">## user_device           3   9154.8  9198.8</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="do">## fam_members           1   8535.4  8583.4</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a><span class="do">## country               6   8543.7  8581.7</span></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="co"># Model:</span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a><span class="co"># lotr ~ premium + age + genre_likes + actor_likes + similar_user_ratings + </span></span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a><span class="co">#     mean_time_genre + user_time + user_day + user_device + fam_members + </span></span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a><span class="co">#     country</span></span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a><span class="co">#                      Df Deviance     AIC</span></span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a><span class="co"># &lt;none&gt;                    8535.3  8585.3</span></span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a><span class="co"># premium               1   8535.3  8583.3</span></span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a><span class="co"># age                   1  14997.9 15045.9</span></span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a><span class="co"># genre_likes           1   8576.9  8624.9</span></span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a><span class="co"># actor_likes           1   8552.1  8600.1</span></span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a><span class="co"># similar_user_ratings  1  15360.9 15408.9</span></span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a><span class="co"># mean_time_genre       1  10091.2 10139.2</span></span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a><span class="co"># user_time             2   8677.9  8723.9</span></span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a><span class="co"># user_day              6   9012.2  9050.2</span></span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a><span class="co"># user_device           3   9154.8  9198.8</span></span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a><span class="co"># fam_members           1   8535.4  8583.4</span></span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a><span class="co"># country               6   8543.7  8581.7</span></span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a></span>
<span id="cb9-39"><a href="#cb9-39" tabindex="-1"></a><span class="co"># From this, we&#39;re looking for when removing a covariate lowers AIC by 2 units</span></span>
<span id="cb9-40"><a href="#cb9-40" tabindex="-1"></a>  <span class="co"># From the above model, these include:</span></span>
<span id="cb9-41"><a href="#cb9-41" tabindex="-1"></a>  <span class="co"># premium</span></span>
<span id="cb9-42"><a href="#cb9-42" tabindex="-1"></a>  <span class="co"># country</span></span>
<span id="cb9-43"><a href="#cb9-43" tabindex="-1"></a><span class="co"># fam_members is right on the threshold with a DeltaAIC of 1.9</span></span>
<span id="cb9-44"><a href="#cb9-44" tabindex="-1"></a>  <span class="co"># There&#39;s just enough information in fam_members to warrant leaving it in the </span></span>
<span id="cb9-45"><a href="#cb9-45" tabindex="-1"></a>  <span class="co"># model</span></span></code></pre></div>
<p>Using <code>drop1()</code> to identify which covariates can be
removed, refit that model.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(lotr <span class="sc">~</span> age <span class="sc">+</span> genre_likes <span class="sc">+</span> actor_likes <span class="sc">+</span> similar_user_ratings <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>              mean_time_genre <span class="sc">+</span> user_time <span class="sc">+</span> user_day <span class="sc">+</span> user_device <span class="sc">+</span> fam_members, </span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>            <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">&quot;logit&quot;</span>), </span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>            <span class="at">data =</span> netflix)</span></code></pre></div>
<p><br />
</p>
</div>
<div id="check-your-assumptions." class="section level3">
<h3>7. Check your assumption(s).</h3>
<p><br />
</p>
<p>As always, we want to check how well we’re meeting the assumptions
(which we can test).</p>
<p>Start off by using the methods that have served us well for the <span
class="math inline">\(Poisson\)</span> adn <span
class="math inline">\(Binomial\)</span> GLMs,
(e.g. <code>plot(mod2)</code> and <code>summary()</code>). Are these
plots useful? Can we calculate dispersion for a <span
class="math inline">\(Bernoulli\)</span> GLM?</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Model diagnostic plots:</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co"># Residuals vs Fitted</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="co"># Normally we want to see no weird patterns, but Bernoulli&#39;s always have weird </span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="co"># patterns. This figure is now pretty useless.</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co"># Q-Q Residuals</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>  <span class="co"># We completely ignore this figure for GLMs.</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co"># Scale-Location</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>  <span class="co"># Uselss for Bernoulli GLMs</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co"># Residuals vs Leverage</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>  <span class="co"># Still useful, even for Bernoulli GLMs. We don&#39;t want any points to be close</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>  <span class="co"># to a Cook&#39;s distance of 1. Here we&#39;re pretty safe.</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co"># Overall, the diagnostic plots are not useful for Bernoulli GlMs, other than</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>  <span class="co"># the Residuals vs Leverage check (which had no issue).</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="co"># Ideally we would do a check for over-dispersion, but we can&#39;t do this Bernoulli&#39;s,</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>  <span class="co"># so we ignore over-dispersion</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co"># We&#39;re now in a position where we don&#39;t really know how well our model has performed</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a>  <span class="co"># with the above checks. What to do?</span></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>)) <span class="co"># Show figures in 2 rows and 2 columns</span></span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a><span class="fu">plot</span>(mod1, <span class="at">col =</span> <span class="fu">ifelse</span>(netflix<span class="sc">$</span>lotr <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="co"># Plot diagnostics</span></span></code></pre></div>
<p><img src="GLM_3_Bernoulli_exercise_solutions_files/figure-html/Q7-1.png" width="672" /></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)) <span class="co"># Reset so only 1 figure is shown</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="fu">summary</span>(mod1)       <span class="co"># Get the summary of the model (to check dispersion?)</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="do">## glm(formula = lotr ~ premium + age + genre_likes + actor_likes + </span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="do">##     similar_user_ratings + mean_time_genre + user_time + user_day + </span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="do">##     user_device + fam_members + country, family = binomial(link = &quot;logit&quot;), </span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="do">##     data = netflix)</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="do">##                            Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="do">## (Intercept)              -2.2306069  0.2323080  -9.602  &lt; 2e-16 ***</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="do">## premiumStandard           0.0028593  0.0687968   0.042   0.9668    </span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="do">## age                      -0.3438283  0.0065422 -52.555  &lt; 2e-16 ***</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="do">## genre_likes               0.1253557  0.0195251   6.420 1.36e-10 ***</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="do">## actor_likes               0.0656155  0.0160403   4.091 4.30e-05 ***</span></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="do">## similar_user_ratings     12.9730705  0.2393122  54.210  &lt; 2e-16 ***</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="do">## mean_time_genre           0.0191951  0.0005533  34.691  &lt; 2e-16 ***</span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="do">## user_timeAfternoon        0.1656040  0.0995200   1.664   0.0961 .  </span></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a><span class="do">## user_timeEvening          0.7864442  0.0938088   8.383  &lt; 2e-16 ***</span></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a><span class="do">## user_dayTuesday          -0.2751947  0.1212624  -2.269   0.0232 *  </span></span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a><span class="do">## user_dayWednesday        -0.5400041  0.1186085  -4.553 5.29e-06 ***</span></span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a><span class="do">## user_dayThursday         -0.8358748  0.1138787  -7.340 2.14e-13 ***</span></span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a><span class="do">## user_dayFriday           -0.0570192  0.1034783  -0.551   0.5816    </span></span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a><span class="do">## user_daySaturday          0.2530024  0.1027725   2.462   0.0138 *  </span></span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a><span class="do">## user_daySunday            1.0832320  0.1029025  10.527  &lt; 2e-16 ***</span></span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a><span class="do">## user_deviceMobile Device -0.9094071  0.1133710  -8.022 1.04e-15 ***</span></span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a><span class="do">## user_devicePC             1.1081155  0.1305752   8.486  &lt; 2e-16 ***</span></span>
<span id="cb12-29"><a href="#cb12-29" tabindex="-1"></a><span class="do">## user_deviceTV             1.0058487  0.0919621  10.938  &lt; 2e-16 ***</span></span>
<span id="cb12-30"><a href="#cb12-30" tabindex="-1"></a><span class="do">## fam_members              -0.0046208  0.0191256  -0.242   0.8091    </span></span>
<span id="cb12-31"><a href="#cb12-31" tabindex="-1"></a><span class="do">## countryFR                 0.0132639  0.0998537   0.133   0.8943    </span></span>
<span id="cb12-32"><a href="#cb12-32" tabindex="-1"></a><span class="do">## countryJP                -0.3201632  0.1952887  -1.639   0.1011    </span></span>
<span id="cb12-33"><a href="#cb12-33" tabindex="-1"></a><span class="do">## countryMX                -0.0247879  0.1043641  -0.238   0.8123    </span></span>
<span id="cb12-34"><a href="#cb12-34" tabindex="-1"></a><span class="do">## countryNZ                 0.1096881  0.1451759   0.756   0.4499    </span></span>
<span id="cb12-35"><a href="#cb12-35" tabindex="-1"></a><span class="do">## countryUK                -0.0958461  0.0921091  -1.041   0.2981    </span></span>
<span id="cb12-36"><a href="#cb12-36" tabindex="-1"></a><span class="do">## countryUS                 0.0704606  0.0828246   0.851   0.3949    </span></span>
<span id="cb12-37"><a href="#cb12-37" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb12-38"><a href="#cb12-38" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb12-39"><a href="#cb12-39" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb12-40"><a href="#cb12-40" tabindex="-1"></a><span class="do">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb12-41"><a href="#cb12-41" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb12-42"><a href="#cb12-42" tabindex="-1"></a><span class="do">##     Null deviance: 20748.0  on 14999  degrees of freedom</span></span>
<span id="cb12-43"><a href="#cb12-43" tabindex="-1"></a><span class="do">## Residual deviance:  8535.3  on 14975  degrees of freedom</span></span>
<span id="cb12-44"><a href="#cb12-44" tabindex="-1"></a><span class="do">## AIC: 8585.3</span></span>
<span id="cb12-45"><a href="#cb12-45" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb12-46"><a href="#cb12-46" tabindex="-1"></a><span class="do">## Number of Fisher Scoring iterations: 7</span></span></code></pre></div>
<p><br />
</p>
<p>The diagnostics tests we’ve used up to this point have largely failed
us for Bernoulli GLMs. As such we need to think of alternative ways to
try and check our assumptions. In this instance, we can use the method
we discussed in the lecture where we extract the Pearson residuals from
the model, and plot these against our explanatory covariates.</p>
<p>Extracting residuals is a pretty easy process. To do so, we use the
code:</p>
<pre><code>netflix$resid &lt;- resid(mod2, type = &quot;pearson&quot;)</code></pre>
<p>With the above code, we’re simply adding a new column to our original
dataset that contains the Pearson residual error for each observation
(<span class="math inline">\(i\)</span>) based on the model that you fit
(here, called <code>mod2</code>). Now we need to load a package and use
the appropriate function to make plotting residuals and diagnosing a bit
easier: <code>binnedplot</code> from the <code>arm</code> package.</p>
<p>Using these plots, identify any covariates you think we should be
concerned about, and why.</p>
<p>Hints: * For categorical variables, we can force these to be numeric,
and therefore use <code>binnedplot()</code> by doing
<code>binnedplot(y = dat$resid, x = as.numeric(dat$category), nclass = 3, xlab = "My categorical variable")</code></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># Extract residuals from model</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>netflix<span class="sc">$</span>resid <span class="ot">&lt;-</span> <span class="fu">resid</span>(mod2, <span class="at">type =</span> <span class="st">&quot;pearson&quot;</span>)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co"># Using binnedplot() from arm package</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="fu">library</span>(arm)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co"># For categorical covariates in the model</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co"># We convert the categories to numeric using as.numeric()</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="fu">binnedplot</span>(<span class="at">y =</span> netflix<span class="sc">$</span>resid, <span class="at">x =</span> <span class="fu">as.numeric</span>(netflix<span class="sc">$</span>user_time), <span class="at">nclass =</span> <span class="dv">3</span>, <span class="at">xlab =</span> <span class="st">&quot;User time&quot;</span>)</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="co"># Pretty good. Nothing that is concerning</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="fu">binnedplot</span>(<span class="at">y =</span> netflix<span class="sc">$</span>resid, <span class="at">x =</span> <span class="fu">as.numeric</span>(netflix<span class="sc">$</span>user_day), <span class="at">nclass =</span> <span class="dv">7</span>, <span class="at">xlab =</span> <span class="st">&quot;User day&quot;</span>)</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a><span class="co"># Pretty good also if slightly too negative</span></span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="fu">binnedplot</span>(<span class="at">y =</span> netflix<span class="sc">$</span>resid, <span class="at">x =</span> <span class="fu">as.numeric</span>(netflix<span class="sc">$</span>user_device), <span class="at">nclass =</span> <span class="dv">8</span>, <span class="at">xlab =</span> <span class="st">&quot;User device&quot;</span>)</span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a><span class="co"># We have to set nclass = 8 to get a bin for each device (4 device types)</span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a><span class="co"># But plot suggests no issues</span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>))</span></code></pre></div>
<p><img src="GLM_3_Bernoulli_exercise_solutions_files/figure-html/Q7.1-1.png" width="672" /></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># For continuous covariates in the model</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="fu">binnedplot</span>(<span class="at">y =</span> netflix<span class="sc">$</span>resid, <span class="at">x =</span> netflix<span class="sc">$</span>age, <span class="at">nclass =</span> <span class="dv">6</span>, <span class="at">xlab =</span> <span class="st">&quot;Age&quot;</span>)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co"># Very likely that age is not a linear effect</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>  <span class="co"># We go from lots of negative, to lots of positive error</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>  <span class="co"># Model is struggling to deal with age</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>  <span class="co"># Assumption of linearity with age is likely broken here</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="fu">binnedplot</span>(<span class="at">y =</span> netflix<span class="sc">$</span>resid, <span class="at">x =</span> netflix<span class="sc">$</span>genre_likes, <span class="at">nclass =</span> <span class="dv">4</span>, <span class="at">xlab =</span> <span class="st">&quot;Genre likes&quot;</span>)</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co"># Pretty good - mostly evenly spread around 0</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="fu">binnedplot</span>(<span class="at">y =</span> netflix<span class="sc">$</span>resid, <span class="at">x =</span> netflix<span class="sc">$</span>actor_likes, <span class="at">nclass =</span> <span class="dv">4</span>, <span class="at">xlab =</span> <span class="st">&quot;Actor likes&quot;</span>)</span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="co"># Pretty good - all points within bounds</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>  <span class="co"># Slightly more negative than we might like but ok</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="fu">binnedplot</span>(<span class="at">y =</span> netflix<span class="sc">$</span>resid, <span class="at">x =</span> netflix<span class="sc">$</span>similar_user_ratings, <span class="at">nclass =</span> <span class="dv">4</span>, <span class="at">xlab =</span> <span class="st">&quot;Similar ratings&quot;</span>)</span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="co"># Mostly ok. At low similar rating we are below bounds, but not terribly</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a><span class="fu">binnedplot</span>(<span class="at">y =</span> netflix<span class="sc">$</span>resid, <span class="at">x =</span> netflix<span class="sc">$</span>mean_time_genre, <span class="at">nclass =</span> <span class="dv">4</span>, <span class="at">xlab =</span> <span class="st">&quot;Mean time spent watching fantasy&quot;</span>)</span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a><span class="co"># Pretty good. At 100 hours of watch time, we are ever-so-slightly below line but it&#39;s ok</span></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a><span class="fu">binnedplot</span>(<span class="at">y =</span> netflix<span class="sc">$</span>resid, <span class="at">x =</span> netflix<span class="sc">$</span>fam_members, <span class="at">nclass =</span> <span class="dv">4</span>, <span class="at">xlab =</span> <span class="st">&quot;Number of family members&quot;</span>)</span></code></pre></div>
<p><img src="GLM_3_Bernoulli_exercise_solutions_files/figure-html/Q7.1-2.png" width="672" /></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co"># Pretty good</span></span></code></pre></div>
<p><br />
</p>
</div>
<div id="interpret-your-model." class="section level3">
<h3>8. Interpret your model.</h3>
<p><br />
</p>
<p>Having now fit our most parsimonious model, let’s see what we’ve
learnt from it. Use <code>summary()</code> to pull up the coefficients
table and answer the following questions:</p>
<ul>
<li>How many parameters have been estimated by this model?</li>
<li>How might we want to change data collection methods to make the
model more efficient in terms of the number of parameters?</li>
<li>What does the <code>user_dayFriday</code> Estimate represent?</li>
<li>For every additional family member (<code>fam_members</code>), how
much does the log odds ratio increase by?</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">summary</span>(mod2)</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="do">## glm(formula = lotr ~ age + genre_likes + actor_likes + similar_user_ratings + </span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="do">##     mean_time_genre + user_time + user_day + user_device + fam_members, </span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="do">##     family = binomial(link = &quot;logit&quot;), data = netflix)</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="do">## Coefficients:</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="do">##                            Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="do">## (Intercept)              -2.2170365  0.2170986 -10.212  &lt; 2e-16 ***</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="do">## age                      -0.3437752  0.0065373 -52.587  &lt; 2e-16 ***</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="do">## genre_likes               0.1249627  0.0195066   6.406 1.49e-10 ***</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="do">## actor_likes               0.0643134  0.0160260   4.013 5.99e-05 ***</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a><span class="do">## similar_user_ratings     12.9650321  0.2390317  54.240  &lt; 2e-16 ***</span></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="do">## mean_time_genre           0.0192068  0.0005529  34.740  &lt; 2e-16 ***</span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="do">## user_timeAfternoon        0.1658946  0.0994637   1.668   0.0953 .  </span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a><span class="do">## user_timeEvening          0.7851001  0.0937494   8.374  &lt; 2e-16 ***</span></span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a><span class="do">## user_dayTuesday          -0.2761958  0.1211418  -2.280   0.0226 *  </span></span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a><span class="do">## user_dayWednesday        -0.5379722  0.1184921  -4.540 5.62e-06 ***</span></span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a><span class="do">## user_dayThursday         -0.8373645  0.1137974  -7.358 1.86e-13 ***</span></span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a><span class="do">## user_dayFriday           -0.0553916  0.1033254  -0.536   0.5919    </span></span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a><span class="do">## user_daySaturday          0.2520935  0.1026561   2.456   0.0141 *  </span></span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a><span class="do">## user_daySunday            1.0829502  0.1027404  10.541  &lt; 2e-16 ***</span></span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a><span class="do">## user_deviceMobile Device -0.9108165  0.1132527  -8.042 8.81e-16 ***</span></span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a><span class="do">## user_devicePC             1.1081704  0.1304357   8.496  &lt; 2e-16 ***</span></span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a><span class="do">## user_deviceTV             1.0054722  0.0918184  10.951  &lt; 2e-16 ***</span></span>
<span id="cb17-27"><a href="#cb17-27" tabindex="-1"></a><span class="do">## fam_members              -0.0055314  0.0191144  -0.289   0.7723    </span></span>
<span id="cb17-28"><a href="#cb17-28" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb17-29"><a href="#cb17-29" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb17-30"><a href="#cb17-30" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-31"><a href="#cb17-31" tabindex="-1"></a><span class="do">## (Dispersion parameter for binomial family taken to be 1)</span></span>
<span id="cb17-32"><a href="#cb17-32" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-33"><a href="#cb17-33" tabindex="-1"></a><span class="do">##     Null deviance: 20748.0  on 14999  degrees of freedom</span></span>
<span id="cb17-34"><a href="#cb17-34" tabindex="-1"></a><span class="do">## Residual deviance:  8543.7  on 14982  degrees of freedom</span></span>
<span id="cb17-35"><a href="#cb17-35" tabindex="-1"></a><span class="do">## AIC: 8579.7</span></span>
<span id="cb17-36"><a href="#cb17-36" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-37"><a href="#cb17-37" tabindex="-1"></a><span class="do">## Number of Fisher Scoring iterations: 7</span></span>
<span id="cb17-38"><a href="#cb17-38" tabindex="-1"></a><span class="co"># Coefficients:</span></span>
<span id="cb17-39"><a href="#cb17-39" tabindex="-1"></a><span class="co">#                            Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb17-40"><a href="#cb17-40" tabindex="-1"></a><span class="co"># (Intercept)              -2.2170365  0.2170986 -10.212  &lt; 2e-16 ***</span></span>
<span id="cb17-41"><a href="#cb17-41" tabindex="-1"></a><span class="co"># age                      -0.3437752  0.0065373 -52.587  &lt; 2e-16 ***</span></span>
<span id="cb17-42"><a href="#cb17-42" tabindex="-1"></a><span class="co"># genre_likes               0.1249627  0.0195066   6.406 1.49e-10 ***</span></span>
<span id="cb17-43"><a href="#cb17-43" tabindex="-1"></a><span class="co"># actor_likes               0.0643134  0.0160260   4.013 5.99e-05 ***</span></span>
<span id="cb17-44"><a href="#cb17-44" tabindex="-1"></a><span class="co"># similar_user_ratings     12.9650321  0.2390317  54.240  &lt; 2e-16 ***</span></span>
<span id="cb17-45"><a href="#cb17-45" tabindex="-1"></a><span class="co"># mean_time_genre           0.0192068  0.0005529  34.740  &lt; 2e-16 ***</span></span>
<span id="cb17-46"><a href="#cb17-46" tabindex="-1"></a><span class="co"># user_timeAfternoon        0.1658946  0.0994637   1.668   0.0953 .  </span></span>
<span id="cb17-47"><a href="#cb17-47" tabindex="-1"></a><span class="co"># user_timeEvening          0.7851001  0.0937494   8.374  &lt; 2e-16 ***</span></span>
<span id="cb17-48"><a href="#cb17-48" tabindex="-1"></a><span class="co"># user_dayTuesday          -0.2761958  0.1211418  -2.280   0.0226 *  </span></span>
<span id="cb17-49"><a href="#cb17-49" tabindex="-1"></a><span class="co"># user_dayWednesday        -0.5379722  0.1184921  -4.540 5.62e-06 ***</span></span>
<span id="cb17-50"><a href="#cb17-50" tabindex="-1"></a><span class="co"># user_dayThursday         -0.8373645  0.1137974  -7.358 1.86e-13 ***</span></span>
<span id="cb17-51"><a href="#cb17-51" tabindex="-1"></a><span class="co"># user_dayFriday           -0.0553916  0.1033254  -0.536   0.5919    </span></span>
<span id="cb17-52"><a href="#cb17-52" tabindex="-1"></a><span class="co"># user_daySaturday          0.2520935  0.1026561   2.456   0.0141 *  </span></span>
<span id="cb17-53"><a href="#cb17-53" tabindex="-1"></a><span class="co"># user_daySunday            1.0829502  0.1027404  10.541  &lt; 2e-16 ***</span></span>
<span id="cb17-54"><a href="#cb17-54" tabindex="-1"></a><span class="co"># user_deviceMobile Device -0.9108165  0.1132527  -8.042 8.81e-16 ***</span></span>
<span id="cb17-55"><a href="#cb17-55" tabindex="-1"></a><span class="co"># user_devicePC             1.1081704  0.1304357   8.496  &lt; 2e-16 ***</span></span>
<span id="cb17-56"><a href="#cb17-56" tabindex="-1"></a><span class="co"># user_deviceTV             1.0054722  0.0918184  10.951  &lt; 2e-16 ***</span></span>
<span id="cb17-57"><a href="#cb17-57" tabindex="-1"></a><span class="co"># fam_members              -0.0055314  0.0191144  -0.289   0.7723    </span></span>
<span id="cb17-58"><a href="#cb17-58" tabindex="-1"></a></span>
<span id="cb17-59"><a href="#cb17-59" tabindex="-1"></a><span class="co"># How many parameters have been estimated by this model?</span></span>
<span id="cb17-60"><a href="#cb17-60" tabindex="-1"></a>  <span class="co"># There are a total of 18 parameters in this model. The number of parameters is</span></span>
<span id="cb17-61"><a href="#cb17-61" tabindex="-1"></a></span>
<span id="cb17-62"><a href="#cb17-62" tabindex="-1"></a><span class="co"># How might we want to change data collection methods to make the model more efficient in terms of the number of parameters?</span></span>
<span id="cb17-63"><a href="#cb17-63" tabindex="-1"></a>  <span class="co"># We have more parameter than covariates because of the categorical variables</span></span>
<span id="cb17-64"><a href="#cb17-64" tabindex="-1"></a>  <span class="co"># So just three covariates (user_time, user_day and user_device) are using 11 parameters</span></span>
<span id="cb17-65"><a href="#cb17-65" tabindex="-1"></a>  <span class="co"># Two of these (user_time and user_day) could be expressed as numbers but there </span></span>
<span id="cb17-66"><a href="#cb17-66" tabindex="-1"></a>  <span class="co"># are two complications if we do so.</span></span>
<span id="cb17-67"><a href="#cb17-67" tabindex="-1"></a>  <span class="co"># For user_time, we have not been provided with the actual time, just a broad</span></span>
<span id="cb17-68"><a href="#cb17-68" tabindex="-1"></a>  <span class="co"># window. So we&#39;d need more accurate information to resolve this.</span></span>
<span id="cb17-69"><a href="#cb17-69" tabindex="-1"></a>  <span class="co"># For user_day, we can already convert this to numeric, e.g. Monday = 1,</span></span>
<span id="cb17-70"><a href="#cb17-70" tabindex="-1"></a>  <span class="co"># Sunday = 7 but this does create an issue. Because weeks are cyclical, the </span></span>
<span id="cb17-71"><a href="#cb17-71" tabindex="-1"></a>  <span class="co"># predicted probability to watch LoTR on Sunday needs to match up, in some manner,</span></span>
<span id="cb17-72"><a href="#cb17-72" tabindex="-1"></a>  <span class="co"># with the predicated probability to watch LoTR on Monday.</span></span>
<span id="cb17-73"><a href="#cb17-73" tabindex="-1"></a>  <span class="co"># There are techniques to do this, but we don&#39;t have the time to cover them on</span></span>
<span id="cb17-74"><a href="#cb17-74" tabindex="-1"></a>  <span class="co"># this course. In such cases, having day of week as a categorical is actually a</span></span>
<span id="cb17-75"><a href="#cb17-75" tabindex="-1"></a>  <span class="co"># pretty good work-around. If you&#39;re interested in the alternative way, look up</span></span>
<span id="cb17-76"><a href="#cb17-76" tabindex="-1"></a>  <span class="co"># cyclical splines in Generalised Additive Models.</span></span>
<span id="cb17-77"><a href="#cb17-77" tabindex="-1"></a></span>
<span id="cb17-78"><a href="#cb17-78" tabindex="-1"></a><span class="co"># * What does the `user_dayFriday` `Estimate` represent?</span></span>
<span id="cb17-79"><a href="#cb17-79" tabindex="-1"></a>  <span class="co"># Hopefully this is starting to become second nature at this point. This is the </span></span>
<span id="cb17-80"><a href="#cb17-80" tabindex="-1"></a>  <span class="co"># difference in logit value for Friday, compared to Monday (our reference level).</span></span>
<span id="cb17-81"><a href="#cb17-81" tabindex="-1"></a>  <span class="co"># For Friday, this model would predict a user is *less* likely to watch LoTR</span></span>
<span id="cb17-82"><a href="#cb17-82" tabindex="-1"></a>  <span class="co"># than on Monday (changing the intercept by -0.0553916).</span></span>
<span id="cb17-83"><a href="#cb17-83" tabindex="-1"></a>  <span class="co"># If your summary table looks different, it&#39;s most likely because you did not</span></span>
<span id="cb17-84"><a href="#cb17-84" tabindex="-1"></a>  <span class="co"># set Monday to be your reference in user_day and Morning to be your reference</span></span>
<span id="cb17-85"><a href="#cb17-85" tabindex="-1"></a>  <span class="co"># in user_time (or you set the user_device reference to something other than</span></span>
<span id="cb17-86"><a href="#cb17-86" tabindex="-1"></a>  <span class="co"># Gaming Device). It&#39;s absolutely fine if so - all it means is that your</span></span>
<span id="cb17-87"><a href="#cb17-87" tabindex="-1"></a>  <span class="co"># Estimate values will be different but, importantly, the effects will be exactly </span></span>
<span id="cb17-88"><a href="#cb17-88" tabindex="-1"></a>  <span class="co"># the same.</span></span>
<span id="cb17-89"><a href="#cb17-89" tabindex="-1"></a>  <span class="co"># The corresponding P-value indicates that there&#39;s a 59% chance that this difference</span></span>
<span id="cb17-90"><a href="#cb17-90" tabindex="-1"></a>  <span class="co"># is actually 0.</span></span>
<span id="cb17-91"><a href="#cb17-91" tabindex="-1"></a></span>
<span id="cb17-92"><a href="#cb17-92" tabindex="-1"></a><span class="co"># * For every additional family member (`fam_members`), how much does the log odds </span></span>
<span id="cb17-93"><a href="#cb17-93" tabindex="-1"></a><span class="co"># ratio increase by?</span></span>
<span id="cb17-94"><a href="#cb17-94" tabindex="-1"></a>  <span class="co"># Adding one more family member decreases the logit value to watch LoTR by</span></span>
<span id="cb17-95"><a href="#cb17-95" tabindex="-1"></a>  <span class="co"># -0.0055314. According to this model, single people are *very* slightly more </span></span>
<span id="cb17-96"><a href="#cb17-96" tabindex="-1"></a>  <span class="co"># likely to watch LoTR.</span></span></code></pre></div>
<p><br />
</p>
</div>
<div id="create-figures-to-show-predicted-relationships."
class="section level3">
<h3>9. Create figures to show predicted relationships.</h3>
<p><br />
</p>
<p>We’re now in a position to show our predicted relationships. To do
so, we’re going to recycle the method we used in the <span
class="math inline">\(Binomial\)</span> GLM exercise.</p>
<p>For these predictions, Netflix are especially interested in
identifying which type of user to give targeted adverts to on
<strong>Sunday afternoons</strong>, such that they are more likely to
watch LoTR. For us, this means we want to make our predictions specific
to Sunday afternoons.</p>
<p>So you don’t have to flip back to the <span
class="math inline">\(Binomial\)</span> GLM exercise, here’s the code we
used to make our predictions in yesterdays exercise.</p>
<pre><code># Create a fake dataset to feed into our model equation
synth_data &lt;- expand.grid(
  n_staff = median(netflix$n_staff), 
  policy = &quot;Implemented&quot;,        
  capacity = seq(
    from = min(netflix$capacity), 
    to = max(netflix$capacity),   
    length.out = 20))   
synth_data$pred &lt;- predict(mod1, newdata = synth_data, se.fit = TRUE)
synth_data$pred &lt;- plogis(pred$fit)
synth_data$low &lt;- plogis(pred$fit - pred$se.fit * 1.96)
synth_data$upp &lt;- plogis(pred$fit + pred$se.fit * 1.96)</code></pre>
<p>Adapt this code for our current model (i.e. add in the relevant
covariates to <code>expand.grid()</code>) to show the relationships for
<code>age</code>, <code>genre_likes</code>, <code>actor_likes</code>,
<code>similar_user_ratings</code>, <code>mean_time_genre</code>,
<code>user_device</code> and <code>family members</code></p>
<p>Your figures should resemble (but need not match exactly):</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="co"># Load packages for plotting</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="do">###### Age ########</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>synth_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>  <span class="at">user_time =</span> <span class="st">&quot;Afternoon&quot;</span>,</span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>  <span class="at">user_day =</span> <span class="st">&quot;Sunday&quot;</span>,</span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>  <span class="co"># Age is variable of interest for prediction</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(netflix<span class="sc">$</span>age), <span class="at">to =</span> <span class="fu">max</span>(netflix<span class="sc">$</span>age), <span class="at">length.out =</span> <span class="dv">50</span>),</span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a>  <span class="co"># Will vary this across user device at the same time</span></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a>  <span class="at">user_device =</span> <span class="fu">c</span>(<span class="st">&quot;Gaming Device&quot;</span>, <span class="st">&quot;Mobile Device&quot;</span>, <span class="st">&quot;PC&quot;</span>, <span class="st">&quot;TV&quot;</span>),</span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a>  <span class="at">genre_likes =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>genre_likes), </span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a>  <span class="at">actor_likes =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>actor_likes),    </span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a>  <span class="at">similar_user_ratings =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>similar_user_ratings),</span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a>  <span class="at">mean_time_genre =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>mean_time_genre),</span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a>  <span class="at">fam_members =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>fam_members)</span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a>)</span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a><span class="co"># Get mean prediction and 95% CI on the response scale</span></span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod2, <span class="at">newdata =</span> synth_data, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a>synth_data<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">plogis</span>(pred<span class="sc">$</span>fit)</span>
<span id="cb19-26"><a href="#cb19-26" tabindex="-1"></a>synth_data<span class="sc">$</span>low <span class="ot">&lt;-</span> <span class="fu">plogis</span>(pred<span class="sc">$</span>fit <span class="sc">-</span> pred<span class="sc">$</span>se.fit <span class="sc">*</span> <span class="fl">1.96</span>)</span>
<span id="cb19-27"><a href="#cb19-27" tabindex="-1"></a>synth_data<span class="sc">$</span>upp <span class="ot">&lt;-</span> <span class="fu">plogis</span>(pred<span class="sc">$</span>fit <span class="sc">+</span> pred<span class="sc">$</span>se.fit <span class="sc">*</span> <span class="fl">1.96</span>)</span>
<span id="cb19-28"><a href="#cb19-28" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" tabindex="-1"></a><span class="co"># Plot for age</span></span>
<span id="cb19-30"><a href="#cb19-30" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(synth_data, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> pred, <span class="at">ymin =</span> low, <span class="at">ymax =</span> upp, </span>
<span id="cb19-31"><a href="#cb19-31" tabindex="-1"></a>                       <span class="at">colour =</span> user_device, <span class="at">fill =</span> user_device)) <span class="sc">+</span></span>
<span id="cb19-32"><a href="#cb19-32" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb19-33"><a href="#cb19-33" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb19-34"><a href="#cb19-34" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-35"><a href="#cb19-35" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-36"><a href="#cb19-36" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> percent, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb19-37"><a href="#cb19-37" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb19-38"><a href="#cb19-38" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Age of user&quot;</span>,</span>
<span id="cb19-39"><a href="#cb19-39" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Predicted probability to watch LoTR&quot;</span>,</span>
<span id="cb19-40"><a href="#cb19-40" tabindex="-1"></a>       <span class="at">colour =</span> <span class="st">&quot;User device&quot;</span>,</span>
<span id="cb19-41"><a href="#cb19-41" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;User device&quot;</span>)</span>
<span id="cb19-42"><a href="#cb19-42" tabindex="-1"></a></span>
<span id="cb19-43"><a href="#cb19-43" tabindex="-1"></a><span class="do">###### Genre likes ########</span></span>
<span id="cb19-44"><a href="#cb19-44" tabindex="-1"></a></span>
<span id="cb19-45"><a href="#cb19-45" tabindex="-1"></a>synth_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb19-46"><a href="#cb19-46" tabindex="-1"></a>  <span class="at">user_time =</span> <span class="st">&quot;Afternoon&quot;</span>,</span>
<span id="cb19-47"><a href="#cb19-47" tabindex="-1"></a>  <span class="at">user_day =</span> <span class="st">&quot;Sunday&quot;</span>,</span>
<span id="cb19-48"><a href="#cb19-48" tabindex="-1"></a>  <span class="co"># genre_likes is variable of interest for prediction</span></span>
<span id="cb19-49"><a href="#cb19-49" tabindex="-1"></a>  <span class="at">genre_likes =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(netflix<span class="sc">$</span>genre_likes), <span class="at">to =</span> <span class="fu">max</span>(netflix<span class="sc">$</span>genre_likes), <span class="at">length.out =</span> <span class="dv">50</span>),</span>
<span id="cb19-50"><a href="#cb19-50" tabindex="-1"></a>  <span class="co"># Will vary this across user device at the same time</span></span>
<span id="cb19-51"><a href="#cb19-51" tabindex="-1"></a>  <span class="at">user_device =</span> <span class="fu">c</span>(<span class="st">&quot;Gaming Device&quot;</span>, <span class="st">&quot;Mobile Device&quot;</span>, <span class="st">&quot;PC&quot;</span>, <span class="st">&quot;TV&quot;</span>),</span>
<span id="cb19-52"><a href="#cb19-52" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>age), </span>
<span id="cb19-53"><a href="#cb19-53" tabindex="-1"></a>  <span class="at">actor_likes =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>actor_likes),    </span>
<span id="cb19-54"><a href="#cb19-54" tabindex="-1"></a>  <span class="at">similar_user_ratings =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>similar_user_ratings),</span>
<span id="cb19-55"><a href="#cb19-55" tabindex="-1"></a>  <span class="at">mean_time_genre =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>mean_time_genre),</span>
<span id="cb19-56"><a href="#cb19-56" tabindex="-1"></a>  <span class="at">fam_members =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>fam_members)</span>
<span id="cb19-57"><a href="#cb19-57" tabindex="-1"></a>)</span>
<span id="cb19-58"><a href="#cb19-58" tabindex="-1"></a></span>
<span id="cb19-59"><a href="#cb19-59" tabindex="-1"></a><span class="co"># Get mean prediction and 95% CI on the response scale</span></span>
<span id="cb19-60"><a href="#cb19-60" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod2, <span class="at">newdata =</span> synth_data, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-61"><a href="#cb19-61" tabindex="-1"></a>synth_data<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">plogis</span>(pred<span class="sc">$</span>fit)</span>
<span id="cb19-62"><a href="#cb19-62" tabindex="-1"></a>synth_data<span class="sc">$</span>low <span class="ot">&lt;-</span> <span class="fu">plogis</span>(pred<span class="sc">$</span>fit <span class="sc">-</span> pred<span class="sc">$</span>se.fit <span class="sc">*</span> <span class="fl">1.96</span>)</span>
<span id="cb19-63"><a href="#cb19-63" tabindex="-1"></a>synth_data<span class="sc">$</span>upp <span class="ot">&lt;-</span> <span class="fu">plogis</span>(pred<span class="sc">$</span>fit <span class="sc">+</span> pred<span class="sc">$</span>se.fit <span class="sc">*</span> <span class="fl">1.96</span>)</span>
<span id="cb19-64"><a href="#cb19-64" tabindex="-1"></a></span>
<span id="cb19-65"><a href="#cb19-65" tabindex="-1"></a><span class="co"># Plot for genre_likes</span></span>
<span id="cb19-66"><a href="#cb19-66" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(synth_data, <span class="fu">aes</span>(<span class="at">x =</span> genre_likes, <span class="at">y =</span> pred, <span class="at">ymin =</span> low, <span class="at">ymax =</span> upp, </span>
<span id="cb19-67"><a href="#cb19-67" tabindex="-1"></a>                       <span class="at">colour =</span> user_device, <span class="at">fill =</span> user_device)) <span class="sc">+</span></span>
<span id="cb19-68"><a href="#cb19-68" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb19-69"><a href="#cb19-69" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb19-70"><a href="#cb19-70" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-71"><a href="#cb19-71" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-72"><a href="#cb19-72" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> percent, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb19-73"><a href="#cb19-73" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb19-74"><a href="#cb19-74" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Number of fantasy</span><span class="sc">\n</span><span class="st">media liked&quot;</span>,</span>
<span id="cb19-75"><a href="#cb19-75" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Predicted probability to watch LoTR&quot;</span>,</span>
<span id="cb19-76"><a href="#cb19-76" tabindex="-1"></a>       <span class="at">colour =</span> <span class="st">&quot;User device&quot;</span>,</span>
<span id="cb19-77"><a href="#cb19-77" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;User device&quot;</span>)</span>
<span id="cb19-78"><a href="#cb19-78" tabindex="-1"></a></span>
<span id="cb19-79"><a href="#cb19-79" tabindex="-1"></a><span class="do">###### Actor likes ########</span></span>
<span id="cb19-80"><a href="#cb19-80" tabindex="-1"></a></span>
<span id="cb19-81"><a href="#cb19-81" tabindex="-1"></a>synth_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb19-82"><a href="#cb19-82" tabindex="-1"></a>  <span class="at">user_time =</span> <span class="st">&quot;Afternoon&quot;</span>,</span>
<span id="cb19-83"><a href="#cb19-83" tabindex="-1"></a>  <span class="at">user_day =</span> <span class="st">&quot;Sunday&quot;</span>,</span>
<span id="cb19-84"><a href="#cb19-84" tabindex="-1"></a>  <span class="co"># actor_likes is variable of interest for prediction</span></span>
<span id="cb19-85"><a href="#cb19-85" tabindex="-1"></a>  <span class="at">actor_likes =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(netflix<span class="sc">$</span>actor_likes), <span class="at">to =</span> <span class="fu">max</span>(netflix<span class="sc">$</span>actor_likes), <span class="at">length.out =</span> <span class="dv">50</span>),</span>
<span id="cb19-86"><a href="#cb19-86" tabindex="-1"></a>  <span class="co"># Will vary this across user device at the same time</span></span>
<span id="cb19-87"><a href="#cb19-87" tabindex="-1"></a>  <span class="at">user_device =</span> <span class="fu">c</span>(<span class="st">&quot;Gaming Device&quot;</span>, <span class="st">&quot;Mobile Device&quot;</span>, <span class="st">&quot;PC&quot;</span>, <span class="st">&quot;TV&quot;</span>),</span>
<span id="cb19-88"><a href="#cb19-88" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>age), </span>
<span id="cb19-89"><a href="#cb19-89" tabindex="-1"></a>  <span class="at">genre_likes =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>genre_likes),    </span>
<span id="cb19-90"><a href="#cb19-90" tabindex="-1"></a>  <span class="at">similar_user_ratings =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>similar_user_ratings),</span>
<span id="cb19-91"><a href="#cb19-91" tabindex="-1"></a>  <span class="at">mean_time_genre =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>mean_time_genre),</span>
<span id="cb19-92"><a href="#cb19-92" tabindex="-1"></a>  <span class="at">fam_members =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>fam_members)</span>
<span id="cb19-93"><a href="#cb19-93" tabindex="-1"></a>)</span>
<span id="cb19-94"><a href="#cb19-94" tabindex="-1"></a></span>
<span id="cb19-95"><a href="#cb19-95" tabindex="-1"></a><span class="co"># Get mean prediction and 95% CI on the response scale</span></span>
<span id="cb19-96"><a href="#cb19-96" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod2, <span class="at">newdata =</span> synth_data, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-97"><a href="#cb19-97" tabindex="-1"></a>synth_data<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">plogis</span>(pred<span class="sc">$</span>fit)</span>
<span id="cb19-98"><a href="#cb19-98" tabindex="-1"></a>synth_data<span class="sc">$</span>low <span class="ot">&lt;-</span> <span class="fu">plogis</span>(pred<span class="sc">$</span>fit <span class="sc">-</span> pred<span class="sc">$</span>se.fit <span class="sc">*</span> <span class="fl">1.96</span>)</span>
<span id="cb19-99"><a href="#cb19-99" tabindex="-1"></a>synth_data<span class="sc">$</span>upp <span class="ot">&lt;-</span> <span class="fu">plogis</span>(pred<span class="sc">$</span>fit <span class="sc">+</span> pred<span class="sc">$</span>se.fit <span class="sc">*</span> <span class="fl">1.96</span>)</span>
<span id="cb19-100"><a href="#cb19-100" tabindex="-1"></a></span>
<span id="cb19-101"><a href="#cb19-101" tabindex="-1"></a><span class="co"># Plot for actor_likes</span></span>
<span id="cb19-102"><a href="#cb19-102" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(synth_data, <span class="fu">aes</span>(<span class="at">x =</span> actor_likes, <span class="at">y =</span> pred, <span class="at">ymin =</span> low, <span class="at">ymax =</span> upp, </span>
<span id="cb19-103"><a href="#cb19-103" tabindex="-1"></a>                       <span class="at">colour =</span> user_device, <span class="at">fill =</span> user_device)) <span class="sc">+</span></span>
<span id="cb19-104"><a href="#cb19-104" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb19-105"><a href="#cb19-105" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb19-106"><a href="#cb19-106" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-107"><a href="#cb19-107" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-108"><a href="#cb19-108" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> percent, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb19-109"><a href="#cb19-109" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb19-110"><a href="#cb19-110" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Number of media with</span><span class="sc">\n</span><span class="st">cast member liked&quot;</span>,</span>
<span id="cb19-111"><a href="#cb19-111" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Predicted probability to watch LoTR&quot;</span>,</span>
<span id="cb19-112"><a href="#cb19-112" tabindex="-1"></a>       <span class="at">colour =</span> <span class="st">&quot;User device&quot;</span>,</span>
<span id="cb19-113"><a href="#cb19-113" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;User device&quot;</span>)</span>
<span id="cb19-114"><a href="#cb19-114" tabindex="-1"></a></span>
<span id="cb19-115"><a href="#cb19-115" tabindex="-1"></a><span class="do">###### similar_user_ratings ########</span></span>
<span id="cb19-116"><a href="#cb19-116" tabindex="-1"></a></span>
<span id="cb19-117"><a href="#cb19-117" tabindex="-1"></a>synth_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb19-118"><a href="#cb19-118" tabindex="-1"></a>  <span class="at">user_time =</span> <span class="st">&quot;Afternoon&quot;</span>,</span>
<span id="cb19-119"><a href="#cb19-119" tabindex="-1"></a>  <span class="at">user_day =</span> <span class="st">&quot;Sunday&quot;</span>,</span>
<span id="cb19-120"><a href="#cb19-120" tabindex="-1"></a>  <span class="co"># similar_user_ratings is variable of interest for prediction</span></span>
<span id="cb19-121"><a href="#cb19-121" tabindex="-1"></a>  <span class="at">similar_user_ratings =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(netflix<span class="sc">$</span>similar_user_ratings), </span>
<span id="cb19-122"><a href="#cb19-122" tabindex="-1"></a>                             <span class="at">to =</span> <span class="fu">max</span>(netflix<span class="sc">$</span>similar_user_ratings), </span>
<span id="cb19-123"><a href="#cb19-123" tabindex="-1"></a>                             <span class="at">length.out =</span> <span class="dv">50</span>),</span>
<span id="cb19-124"><a href="#cb19-124" tabindex="-1"></a>  <span class="co"># Will vary this across user device at the same time</span></span>
<span id="cb19-125"><a href="#cb19-125" tabindex="-1"></a>  <span class="at">user_device =</span> <span class="fu">c</span>(<span class="st">&quot;Gaming Device&quot;</span>, <span class="st">&quot;Mobile Device&quot;</span>, <span class="st">&quot;PC&quot;</span>, <span class="st">&quot;TV&quot;</span>),</span>
<span id="cb19-126"><a href="#cb19-126" tabindex="-1"></a>  <span class="at">genre_likes =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>genre_likes), </span>
<span id="cb19-127"><a href="#cb19-127" tabindex="-1"></a>  <span class="at">actor_likes =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>actor_likes),    </span>
<span id="cb19-128"><a href="#cb19-128" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>age),</span>
<span id="cb19-129"><a href="#cb19-129" tabindex="-1"></a>  <span class="at">mean_time_genre =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>mean_time_genre),</span>
<span id="cb19-130"><a href="#cb19-130" tabindex="-1"></a>  <span class="at">fam_members =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>fam_members)</span>
<span id="cb19-131"><a href="#cb19-131" tabindex="-1"></a>)</span>
<span id="cb19-132"><a href="#cb19-132" tabindex="-1"></a></span>
<span id="cb19-133"><a href="#cb19-133" tabindex="-1"></a><span class="co"># Get mean prediction and 95% CI on the response scale</span></span>
<span id="cb19-134"><a href="#cb19-134" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod2, <span class="at">newdata =</span> synth_data, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-135"><a href="#cb19-135" tabindex="-1"></a>synth_data<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">plogis</span>(pred<span class="sc">$</span>fit)</span>
<span id="cb19-136"><a href="#cb19-136" tabindex="-1"></a>synth_data<span class="sc">$</span>low <span class="ot">&lt;-</span> <span class="fu">plogis</span>(pred<span class="sc">$</span>fit <span class="sc">-</span> pred<span class="sc">$</span>se.fit <span class="sc">*</span> <span class="fl">1.96</span>)</span>
<span id="cb19-137"><a href="#cb19-137" tabindex="-1"></a>synth_data<span class="sc">$</span>upp <span class="ot">&lt;-</span> <span class="fu">plogis</span>(pred<span class="sc">$</span>fit <span class="sc">+</span> pred<span class="sc">$</span>se.fit <span class="sc">*</span> <span class="fl">1.96</span>)</span>
<span id="cb19-138"><a href="#cb19-138" tabindex="-1"></a></span>
<span id="cb19-139"><a href="#cb19-139" tabindex="-1"></a><span class="co"># Plot for similar_user_ratings</span></span>
<span id="cb19-140"><a href="#cb19-140" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(synth_data, <span class="fu">aes</span>(<span class="at">x =</span> similar_user_ratings, <span class="at">y =</span> pred, <span class="at">ymin =</span> low, <span class="at">ymax =</span> upp, </span>
<span id="cb19-141"><a href="#cb19-141" tabindex="-1"></a>                       <span class="at">colour =</span> user_device, <span class="at">fill =</span> user_device)) <span class="sc">+</span></span>
<span id="cb19-142"><a href="#cb19-142" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb19-143"><a href="#cb19-143" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb19-144"><a href="#cb19-144" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-145"><a href="#cb19-145" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-146"><a href="#cb19-146" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> percent, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb19-147"><a href="#cb19-147" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb19-148"><a href="#cb19-148" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Proportion of similar</span><span class="sc">\n</span><span class="st">users who liked LoTR&quot;</span>,</span>
<span id="cb19-149"><a href="#cb19-149" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Predicted probability to watch LoTR&quot;</span>,</span>
<span id="cb19-150"><a href="#cb19-150" tabindex="-1"></a>       <span class="at">colour =</span> <span class="st">&quot;User device&quot;</span>,</span>
<span id="cb19-151"><a href="#cb19-151" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;User device&quot;</span>)</span>
<span id="cb19-152"><a href="#cb19-152" tabindex="-1"></a></span>
<span id="cb19-153"><a href="#cb19-153" tabindex="-1"></a><span class="do">###### mean_time_genre ########</span></span>
<span id="cb19-154"><a href="#cb19-154" tabindex="-1"></a></span>
<span id="cb19-155"><a href="#cb19-155" tabindex="-1"></a>synth_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb19-156"><a href="#cb19-156" tabindex="-1"></a>  <span class="at">user_time =</span> <span class="st">&quot;Afternoon&quot;</span>,</span>
<span id="cb19-157"><a href="#cb19-157" tabindex="-1"></a>  <span class="at">user_day =</span> <span class="st">&quot;Sunday&quot;</span>,</span>
<span id="cb19-158"><a href="#cb19-158" tabindex="-1"></a>  <span class="co"># mean_time_genre is variable of interest for prediction</span></span>
<span id="cb19-159"><a href="#cb19-159" tabindex="-1"></a>  <span class="at">mean_time_genre =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(netflix<span class="sc">$</span>mean_time_genre), </span>
<span id="cb19-160"><a href="#cb19-160" tabindex="-1"></a>                        <span class="at">to =</span> <span class="fu">max</span>(netflix<span class="sc">$</span>mean_time_genre), </span>
<span id="cb19-161"><a href="#cb19-161" tabindex="-1"></a>                        <span class="at">length.out =</span> <span class="dv">50</span>),</span>
<span id="cb19-162"><a href="#cb19-162" tabindex="-1"></a>  <span class="co"># Will vary this across user device at the same time</span></span>
<span id="cb19-163"><a href="#cb19-163" tabindex="-1"></a>  <span class="at">user_device =</span> <span class="fu">c</span>(<span class="st">&quot;Gaming Device&quot;</span>, <span class="st">&quot;Mobile Device&quot;</span>, <span class="st">&quot;PC&quot;</span>, <span class="st">&quot;TV&quot;</span>),</span>
<span id="cb19-164"><a href="#cb19-164" tabindex="-1"></a>  <span class="at">genre_likes =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>genre_likes), </span>
<span id="cb19-165"><a href="#cb19-165" tabindex="-1"></a>  <span class="at">actor_likes =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>actor_likes),    </span>
<span id="cb19-166"><a href="#cb19-166" tabindex="-1"></a>  <span class="at">similar_user_ratings =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>similar_user_ratings),</span>
<span id="cb19-167"><a href="#cb19-167" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>age),</span>
<span id="cb19-168"><a href="#cb19-168" tabindex="-1"></a>  <span class="at">fam_members =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>fam_members)</span>
<span id="cb19-169"><a href="#cb19-169" tabindex="-1"></a>)</span>
<span id="cb19-170"><a href="#cb19-170" tabindex="-1"></a></span>
<span id="cb19-171"><a href="#cb19-171" tabindex="-1"></a><span class="co"># Get mean prediction and 95% CI on the response scale</span></span>
<span id="cb19-172"><a href="#cb19-172" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod2, <span class="at">newdata =</span> synth_data, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-173"><a href="#cb19-173" tabindex="-1"></a>synth_data<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">plogis</span>(pred<span class="sc">$</span>fit)</span>
<span id="cb19-174"><a href="#cb19-174" tabindex="-1"></a>synth_data<span class="sc">$</span>low <span class="ot">&lt;-</span> <span class="fu">plogis</span>(pred<span class="sc">$</span>fit <span class="sc">-</span> pred<span class="sc">$</span>se.fit <span class="sc">*</span> <span class="fl">1.96</span>)</span>
<span id="cb19-175"><a href="#cb19-175" tabindex="-1"></a>synth_data<span class="sc">$</span>upp <span class="ot">&lt;-</span> <span class="fu">plogis</span>(pred<span class="sc">$</span>fit <span class="sc">+</span> pred<span class="sc">$</span>se.fit <span class="sc">*</span> <span class="fl">1.96</span>)</span>
<span id="cb19-176"><a href="#cb19-176" tabindex="-1"></a></span>
<span id="cb19-177"><a href="#cb19-177" tabindex="-1"></a><span class="co"># Plot for mean_time_genre</span></span>
<span id="cb19-178"><a href="#cb19-178" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(synth_data, <span class="fu">aes</span>(<span class="at">x =</span> mean_time_genre, <span class="at">y =</span> pred, <span class="at">ymin =</span> low, <span class="at">ymax =</span> upp, </span>
<span id="cb19-179"><a href="#cb19-179" tabindex="-1"></a>                       <span class="at">colour =</span> user_device, <span class="at">fill =</span> user_device)) <span class="sc">+</span></span>
<span id="cb19-180"><a href="#cb19-180" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb19-181"><a href="#cb19-181" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb19-182"><a href="#cb19-182" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-183"><a href="#cb19-183" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-184"><a href="#cb19-184" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> percent, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb19-185"><a href="#cb19-185" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb19-186"><a href="#cb19-186" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Mean time spent</span><span class="sc">\n</span><span class="st">watching fantasy&quot;</span>,</span>
<span id="cb19-187"><a href="#cb19-187" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Predicted probability to watch LoTR&quot;</span>,</span>
<span id="cb19-188"><a href="#cb19-188" tabindex="-1"></a>       <span class="at">colour =</span> <span class="st">&quot;User device&quot;</span>,</span>
<span id="cb19-189"><a href="#cb19-189" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;User device&quot;</span>)</span>
<span id="cb19-190"><a href="#cb19-190" tabindex="-1"></a></span>
<span id="cb19-191"><a href="#cb19-191" tabindex="-1"></a><span class="do">###### fam_members ########</span></span>
<span id="cb19-192"><a href="#cb19-192" tabindex="-1"></a></span>
<span id="cb19-193"><a href="#cb19-193" tabindex="-1"></a>synth_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb19-194"><a href="#cb19-194" tabindex="-1"></a>  <span class="at">user_time =</span> <span class="st">&quot;Afternoon&quot;</span>,</span>
<span id="cb19-195"><a href="#cb19-195" tabindex="-1"></a>  <span class="at">user_day =</span> <span class="st">&quot;Sunday&quot;</span>,</span>
<span id="cb19-196"><a href="#cb19-196" tabindex="-1"></a>  <span class="co"># fam_members is variable of interest for prediction</span></span>
<span id="cb19-197"><a href="#cb19-197" tabindex="-1"></a>  <span class="at">fam_members =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(netflix<span class="sc">$</span>fam_members), </span>
<span id="cb19-198"><a href="#cb19-198" tabindex="-1"></a>                    <span class="at">to =</span> <span class="fu">max</span>(netflix<span class="sc">$</span>fam_members), </span>
<span id="cb19-199"><a href="#cb19-199" tabindex="-1"></a>                    <span class="at">length.out =</span> <span class="dv">50</span>),</span>
<span id="cb19-200"><a href="#cb19-200" tabindex="-1"></a>  <span class="co"># Will vary this across user device at the same time</span></span>
<span id="cb19-201"><a href="#cb19-201" tabindex="-1"></a>  <span class="at">user_device =</span> <span class="fu">c</span>(<span class="st">&quot;Gaming Device&quot;</span>, <span class="st">&quot;Mobile Device&quot;</span>, <span class="st">&quot;PC&quot;</span>, <span class="st">&quot;TV&quot;</span>),</span>
<span id="cb19-202"><a href="#cb19-202" tabindex="-1"></a>  <span class="at">genre_likes =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>genre_likes), </span>
<span id="cb19-203"><a href="#cb19-203" tabindex="-1"></a>  <span class="at">actor_likes =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>actor_likes),    </span>
<span id="cb19-204"><a href="#cb19-204" tabindex="-1"></a>  <span class="at">similar_user_ratings =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>similar_user_ratings),</span>
<span id="cb19-205"><a href="#cb19-205" tabindex="-1"></a>  <span class="at">mean_time_genre =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>mean_time_genre),</span>
<span id="cb19-206"><a href="#cb19-206" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">median</span>(netflix<span class="sc">$</span>age)</span>
<span id="cb19-207"><a href="#cb19-207" tabindex="-1"></a>)</span>
<span id="cb19-208"><a href="#cb19-208" tabindex="-1"></a></span>
<span id="cb19-209"><a href="#cb19-209" tabindex="-1"></a><span class="co"># Get mean prediction and 95% CI on the response scale</span></span>
<span id="cb19-210"><a href="#cb19-210" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod2, <span class="at">newdata =</span> synth_data, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-211"><a href="#cb19-211" tabindex="-1"></a>synth_data<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">plogis</span>(pred<span class="sc">$</span>fit)</span>
<span id="cb19-212"><a href="#cb19-212" tabindex="-1"></a>synth_data<span class="sc">$</span>low <span class="ot">&lt;-</span> <span class="fu">plogis</span>(pred<span class="sc">$</span>fit <span class="sc">-</span> pred<span class="sc">$</span>se.fit <span class="sc">*</span> <span class="fl">1.96</span>)</span>
<span id="cb19-213"><a href="#cb19-213" tabindex="-1"></a>synth_data<span class="sc">$</span>upp <span class="ot">&lt;-</span> <span class="fu">plogis</span>(pred<span class="sc">$</span>fit <span class="sc">+</span> pred<span class="sc">$</span>se.fit <span class="sc">*</span> <span class="fl">1.96</span>)</span>
<span id="cb19-214"><a href="#cb19-214" tabindex="-1"></a></span>
<span id="cb19-215"><a href="#cb19-215" tabindex="-1"></a><span class="co"># Plot for fam_members</span></span>
<span id="cb19-216"><a href="#cb19-216" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(synth_data, <span class="fu">aes</span>(<span class="at">x =</span> fam_members, <span class="at">y =</span> pred, <span class="at">ymin =</span> low, <span class="at">ymax =</span> upp, </span>
<span id="cb19-217"><a href="#cb19-217" tabindex="-1"></a>                       <span class="at">colour =</span> user_device, <span class="at">fill =</span> user_device)) <span class="sc">+</span></span>
<span id="cb19-218"><a href="#cb19-218" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb19-219"><a href="#cb19-219" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb19-220"><a href="#cb19-220" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-221"><a href="#cb19-221" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-222"><a href="#cb19-222" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> percent, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb19-223"><a href="#cb19-223" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb19-224"><a href="#cb19-224" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Number of family members&quot;</span>,</span>
<span id="cb19-225"><a href="#cb19-225" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Predicted probability to watch LoTR&quot;</span>,</span>
<span id="cb19-226"><a href="#cb19-226" tabindex="-1"></a>       <span class="at">colour =</span> <span class="st">&quot;User device&quot;</span>,</span>
<span id="cb19-227"><a href="#cb19-227" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;User device&quot;</span>)</span>
<span id="cb19-228"><a href="#cb19-228" tabindex="-1"></a></span>
<span id="cb19-229"><a href="#cb19-229" tabindex="-1"></a><span class="co"># Add all multiples into a single figure</span></span>
<span id="cb19-230"><a href="#cb19-230" tabindex="-1"></a>design_layout <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb19-231"><a href="#cb19-231" tabindex="-1"></a><span class="st">AB</span></span>
<span id="cb19-232"><a href="#cb19-232" tabindex="-1"></a><span class="st">CD</span></span>
<span id="cb19-233"><a href="#cb19-233" tabindex="-1"></a><span class="st">EF</span></span>
<span id="cb19-234"><a href="#cb19-234" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb19-235"><a href="#cb19-235" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span> p4 <span class="sc">+</span> p5 <span class="sc">+</span> p6 <span class="sc">+</span> </span>
<span id="cb19-236"><a href="#cb19-236" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Users to target&quot;</span>) <span class="sc">+</span> </span>
<span id="cb19-237"><a href="#cb19-237" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>, <span class="at">axis_titles =</span> <span class="st">&quot;collect&quot;</span>, <span class="at">design =</span> design_layout)</span></code></pre></div>
<p><img src="GLM_3_Bernoulli_exercise_solutions_files/figure-html/Q9-1.png" width="672" /></p>
<p>Using your figures, what type of user should Netflix use targeted
adverts on, to increase the probability that they watch LoTR?</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="co"># Netflix should target:</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>  <span class="co"># Users watching on TV or PC</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>  <span class="co"># Users under the age of 40</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>  <span class="co"># Users for whom &gt;75% of similar users liked LoTR</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>  <span class="co"># Users who have spent &gt; 200 hours on average watching fantasy</span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="co"># The following do have help making a prediction but are weak</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>  <span class="co"># Users who have liked &gt; 5 fantasy films</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>  <span class="co"># Users who have liked &gt; 7.5 films with same actors</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>  <span class="co"># Users with no family members on their account</span></span></code></pre></div>
<p><br />
</p>
</div>
<div id="the-monkeys-paw" class="section level3">
<h3>10. The Monkey’s Paw</h3>
<p><br />
</p>
<p>Having now fit the model and generated predicted relationships to
allow Netflix to do targeted advertising, stop. Have a think again about
the data. At the end of yesterday’s exercise I explained how that
dataset and model had broken the assumption of validity. Can you think
of any issues here? Were there any assumptions we broke but that got
left behind? What are the consequences of breaking any such
assumptions?</p>
<p><br />
</p>
</div>
<div id="optional-exploring-model-diagnostics" class="section level3">
<h3>11. (Optional) Exploring model diagnostics</h3>
<p>As in previous exercises, below I include code to simulate a <span
class="math inline">\(Bernoulli\)</span> dataset to allow you to explore
the impact of sample size, model misspecification, and effect size, on
model diagnostic plots. The <em>Data Generating Process</em> (DGP) for
the dataset is:</p>
<p><span class="math inline">\(y_i \sim Bernoulli(p_i)\)</span></p>
<p><span class="math inline">\(logit(p_i) = \beta_0 + \beta_1 \times
x_{1,i} + \beta_2 \times x_{2,i} + \beta_3\times x_{3,i} + \beta_4
\times x_{1, i} \times x_{2,i}\)</span></p>
<p>where you are free to decide what the values for the parameters
(<span class="math inline">\(\beta_{0,...,4}\)</span>) are.</p>
<p>I am also including three additional covariates (<span
class="math inline">\(Z_{1,...,3}\)</span>) which have no effect
what-so-ever on <span class="math inline">\(p\)</span>.</p>
<p>Rerun the simulation and analysis varying the sample size
(e.g. <code>N &lt;- 1000</code>), the effect sizes
(e.g. <code>beta_0 &lt;- 10</code>) or the formula of the
<code>glm()</code> (e.g. remove the interaction). Check what effect this
has on the generic diagnostic plots as well as the
<code>binnedplots()</code> from the <code>arm</code> package.</p>
<pre><code># Set your seed to have the randomness be cosnsitent each time you run the code
# You can change this, or comment it out, if you want to embrase the randomness
set.seed(1234)

# Set your sample size
N &lt;- 500

# Set the number of trials (must be 1 for Bernoulli)
k &lt;- 1

# Create three continuous covariates
x1 &lt;- runif(N, 0, 10)
x2 &lt;- runif(N, 0, 10)
x3 &lt;- runif(N, 0, 10)

# Set your parameter values
beta_0 &lt;- 2.5   # This is the intercept (on link scale)
beta_1 &lt;- 0.2   # This is the slope for the x1 variable (on link scale)
beta_2 &lt;- -1.3  # This is the slope for the x2 variable (on link scale)
beta_3 &lt;- 0.4   # This is the slope for the x3 variable (on link scale)
beta_4 &lt;- 0.05  # The combined effect of x1 and x2 (on link scale)

# Generate your linear predictor on the link scale (i.e. log)
# We don&#39;t actually need to use log() here (it&#39;s already on the link scale)
linear_predictor_link &lt;- beta_0 + beta_1 * x1 + beta_2 * x2 + beta_3 * x3 + beta_4 * x1 * x2

# Backtransform your linear predictor to the response scale (i.e. exponentiate)
linear_predictor_response &lt;- plogis(linear_predictor_link)

# Generate your response variable using a Poisson random number generator (rpois)
y &lt;- rbinom(N, size = k, prob = linear_predictor_response)

# Note that the above three lines of code are the equivalent to the equations:
# y ~ Bernoulli(p)
# logit(p) = beta_0 + beta_1 * x1 + beta_2 * x2 + beta_3 * x3 + beta_4 * x1 * x2

# Having simulated the data, we now include three additional covariates that do nothing
z1 &lt;- rbeta(N, shape1 = 10, shape2 = 3)
z2 &lt;- rgamma(N, shape = 15, rate = 2)
z3 &lt;- runif(N, min = 0, max = 100)

# Store your data in a dataframe
dat &lt;- data.frame(y, x1, x2, x3, z1, z2, z3)

# Run a Bernoulli GLM
fit &lt;- glm(y ~ x1 + x2 + x3 + x1 : x2 + z1 + z2 + z3, 
           data = dat, 
           family = binomial)

# See if the model was able to estimate your parameter values 
# and what the dispersion is
summary(fit)

# See how well the model diagnostics perform
par(mfrow = c(2,2))
plot(fit)

# See how AIC reacts to the meaningless variables
drop1(fit)

# Check residuals using the binnedplots
dat$resid &lt;- resid(fit, type = &quot;pearson&quot;)
library(arm)
binnedplot(dat$resid, x = x1, nclass = 5, xlab = &quot;x1&quot;)
binnedplot(dat$resid, x = x2, nclass = 5, xlab = &quot;x2&quot;)
binnedplot(dat$resid, x = x3, nclass = 5, xlab = &quot;x3&quot;)
binnedplot(dat$resid, x = z1, nclass = 5, xlab = &quot;z1&quot;)
binnedplot(dat$resid, x = z2, nclass = 5, xlab = &quot;z2&quot;)
binnedplot(dat$resid, x = z3, nclass = 5, xlab = &quot;z3&quot;)</code></pre>
<p><strong>End of the Bernoulli GLM - predicting Lord of the Rings
viewership</strong>*</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
